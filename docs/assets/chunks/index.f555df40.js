var Wr=Object.defineProperty,Qr=Object.defineProperties;var Jr=Object.getOwnPropertyDescriptors;var Us=Object.getOwnPropertySymbols;var ei=Object.prototype.hasOwnProperty,ti=Object.prototype.propertyIsEnumerable;var Gs=(o,e,t)=>e in o?Wr(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,be=(o,e)=>{for(var t in e||(e={}))ei.call(e,t)&&Gs(o,t,e[t]);if(Us)for(var t of Us(e))ti.call(e,t)&&Gs(o,t,e[t]);return o},at=(o,e)=>Qr(o,Jr(e));import{E as ps,V as A,M as Ge,T as vt,Q as de,S as Hs,a as he,R as xt,O as qe,b as ht,c as Q,d as He,L as fs,C as ye,B as fe,e as $e,F as tt,f as L,g as dn,h as ke,i as ni,j as Gt,P as Zn,D as Io,k as Lo,l as ds,m as si,n as Ne,o as ne,p as ms,q as _n,r as gs,s as Lt,t as De,u as ys,v as oi,I as ri,N as ii,w as Po,x as ai,y as ci,z as li,A as Ro,G as Wn,H as ui,J as Zt,K as Co,U as hi,W as pi,X as vs,Y as fi,Z as di,_ as $s,$ as mi,a0 as pt,a1 as Wt,a2 as ko,a3 as gi,a4 as Do,a5 as yi,a6 as vi,a7 as wi,a8 as Tt,a9 as ws,aa as Pe,ab as No,ac as Oo,ad as Qn,ae as Fo,af as jo,ag as Jn,ah as Bo,ai as bi,aj as Qt,ak as Ei,al as Si,am as Nn,an as Mi,ao as En,ap as zo,aq as Ti,ar as xi,as as _i,at as Ai,au as Uo,av as Ii,aw as Li,ax as Xs,ay as qs,az as Go,aA as bs,aB as Pi}from"./three.module.63d72939.js";import{l as es,f as K,m as B,n as Ye,q as J,s as le,v as Oe,o as Pt,c as Rt,x as Ho,i as $o,y as Vs,z as Ri,A as Ci,B as zn}from"../app.1f3a6091.js";const ki="0.0.0-dev.0",Ks=Symbol("INSTALLED");var Di=(o=[])=>({version:ki,install:t=>{t[Ks]||(t[Ks]=!0,o.forEach(n=>t.use(n)))}});const Ys={type:"change"},Un={type:"start"},Zs={type:"end"};class ts extends ps{constructor(e,t){super(),t===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderers.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new A,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Ge.ROTATE,MIDDLE:Ge.DOLLY,RIGHT:Ge.PAN},this.touches={ONE:vt.ROTATE,TWO:vt.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(b){b.addEventListener("keydown",Os),this._domElementKeyEvents=b},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Ys),n.update(),r=s.NONE},this.update=function(){const b=new A,D=new de().setFromUnitVectors(e.up,new A(0,1,0)),pe=D.clone().invert(),ge=new A,Le=new de,yt=2*Math.PI;return function(){const zs=n.object.position;b.copy(zs).sub(n.target),b.applyQuaternion(D),a.setFromVector3(b),n.autoRotate&&r===s.NONE&&R(T()),n.enableDamping?(a.theta+=c.theta*n.dampingFactor,a.phi+=c.phi*n.dampingFactor):(a.theta+=c.theta,a.phi+=c.phi);let je=n.minAzimuthAngle,Be=n.maxAzimuthAngle;return isFinite(je)&&isFinite(Be)&&(je<-Math.PI?je+=yt:je>Math.PI&&(je-=yt),Be<-Math.PI?Be+=yt:Be>Math.PI&&(Be-=yt),je<=Be?a.theta=Math.max(je,Math.min(Be,a.theta)):a.theta=a.theta>(je+Be)/2?Math.max(je,a.theta):Math.min(Be,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=l,a.radius=Math.max(n.minDistance,Math.min(n.maxDistance,a.radius)),n.enableDamping===!0?n.target.addScaledVector(h,n.dampingFactor):n.target.add(h),b.setFromSpherical(a),b.applyQuaternion(pe),zs.copy(n.target).add(b),n.object.lookAt(n.target),n.enableDamping===!0?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,h.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),h.set(0,0,0)),l=1,u||ge.distanceToSquared(n.object.position)>i||8*(1-Le.dot(n.object.quaternion))>i?(n.dispatchEvent(Ys),ge.copy(n.object.position),Le.copy(n.object.quaternion),u=!1,!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",Fs),n.domElement.removeEventListener("pointerdown",gt),n.domElement.removeEventListener("pointercancel",Ds),n.domElement.removeEventListener("wheel",Ns),n.domElement.removeEventListener("pointermove",Fn),n.domElement.removeEventListener("pointerup",jn),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",Os)};const n=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=s.NONE;const i=1e-6,a=new Hs,c=new Hs;let l=1;const h=new A;let u=!1;const p=new he,f=new he,d=new he,m=new he,g=new he,w=new he,y=new he,v=new he,S=new he,E=[],_={};function T(){return 2*Math.PI/60/60*n.autoRotateSpeed}function M(){return Math.pow(.95,n.zoomSpeed)}function R(b){c.theta-=b}function x(b){c.phi-=b}const O=function(){const b=new A;return function(pe,ge){b.setFromMatrixColumn(ge,0),b.multiplyScalar(-pe),h.add(b)}}(),C=function(){const b=new A;return function(pe,ge){n.screenSpacePanning===!0?b.setFromMatrixColumn(ge,1):(b.setFromMatrixColumn(ge,0),b.crossVectors(n.object.up,b)),b.multiplyScalar(pe),h.add(b)}}(),I=function(){const b=new A;return function(pe,ge){const Le=n.domElement;if(n.object.isPerspectiveCamera){const yt=n.object.position;b.copy(yt).sub(n.target);let fn=b.length();fn*=Math.tan(n.object.fov/2*Math.PI/180),O(2*pe*fn/Le.clientHeight,n.object.matrix),C(2*ge*fn/Le.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(O(pe*(n.object.right-n.object.left)/n.object.zoom/Le.clientWidth,n.object.matrix),C(ge*(n.object.top-n.object.bottom)/n.object.zoom/Le.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function P(b){n.object.isPerspectiveCamera?l/=b:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*b)),n.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function k(b){n.object.isPerspectiveCamera?l*=b:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/b)),n.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function N(b){p.set(b.clientX,b.clientY)}function F(b){y.set(b.clientX,b.clientY)}function H(b){m.set(b.clientX,b.clientY)}function $(b){f.set(b.clientX,b.clientY),d.subVectors(f,p).multiplyScalar(n.rotateSpeed);const D=n.domElement;R(2*Math.PI*d.x/D.clientHeight),x(2*Math.PI*d.y/D.clientHeight),p.copy(f),n.update()}function oe(b){v.set(b.clientX,b.clientY),S.subVectors(v,y),S.y>0?P(M()):S.y<0&&k(M()),y.copy(v),n.update()}function X(b){g.set(b.clientX,b.clientY),w.subVectors(g,m).multiplyScalar(n.panSpeed),I(w.x,w.y),m.copy(g),n.update()}function se(b){b.deltaY<0?k(M()):b.deltaY>0&&P(M()),n.update()}function we(b){let D=!1;switch(b.code){case n.keys.UP:I(0,n.keyPanSpeed),D=!0;break;case n.keys.BOTTOM:I(0,-n.keyPanSpeed),D=!0;break;case n.keys.LEFT:I(n.keyPanSpeed,0),D=!0;break;case n.keys.RIGHT:I(-n.keyPanSpeed,0),D=!0;break}D&&(b.preventDefault(),n.update())}function ae(){if(E.length===1)p.set(E[0].pageX,E[0].pageY);else{const b=.5*(E[0].pageX+E[1].pageX),D=.5*(E[0].pageY+E[1].pageY);p.set(b,D)}}function ue(){if(E.length===1)m.set(E[0].pageX,E[0].pageY);else{const b=.5*(E[0].pageX+E[1].pageX),D=.5*(E[0].pageY+E[1].pageY);m.set(b,D)}}function rt(){const b=E[0].pageX-E[1].pageX,D=E[0].pageY-E[1].pageY,pe=Math.sqrt(b*b+D*D);y.set(0,pe)}function it(){n.enableZoom&&rt(),n.enablePan&&ue()}function Ze(){n.enableZoom&&rt(),n.enableRotate&&ae()}function hn(b){if(E.length==1)f.set(b.pageX,b.pageY);else{const pe=Bn(b),ge=.5*(b.pageX+pe.x),Le=.5*(b.pageY+pe.y);f.set(ge,Le)}d.subVectors(f,p).multiplyScalar(n.rotateSpeed);const D=n.domElement;R(2*Math.PI*d.x/D.clientHeight),x(2*Math.PI*d.y/D.clientHeight),p.copy(f)}function zt(b){if(E.length===1)g.set(b.pageX,b.pageY);else{const D=Bn(b),pe=.5*(b.pageX+D.x),ge=.5*(b.pageY+D.y);g.set(pe,ge)}w.subVectors(g,m).multiplyScalar(n.panSpeed),I(w.x,w.y),m.copy(g)}function Ut(b){const D=Bn(b),pe=b.pageX-D.x,ge=b.pageY-D.y,Le=Math.sqrt(pe*pe+ge*ge);v.set(0,Le),S.set(0,Math.pow(v.y/y.y,n.zoomSpeed)),P(S.y),y.copy(v)}function pn(b){n.enableZoom&&Ut(b),n.enablePan&&zt(b)}function Xr(b){n.enableZoom&&Ut(b),n.enableRotate&&hn(b)}function gt(b){n.enabled!==!1&&(E.length===0&&(n.domElement.setPointerCapture(b.pointerId),n.domElement.addEventListener("pointermove",Fn),n.domElement.addEventListener("pointerup",jn)),Zr(b),b.pointerType==="touch"?Kr(b):qr(b))}function Fn(b){n.enabled!==!1&&(b.pointerType==="touch"?Yr(b):Vr(b))}function jn(b){js(b),E.length===0&&(n.domElement.releasePointerCapture(b.pointerId),n.domElement.removeEventListener("pointermove",Fn),n.domElement.removeEventListener("pointerup",jn)),n.dispatchEvent(Zs),r=s.NONE}function Ds(b){js(b)}function qr(b){let D;switch(b.button){case 0:D=n.mouseButtons.LEFT;break;case 1:D=n.mouseButtons.MIDDLE;break;case 2:D=n.mouseButtons.RIGHT;break;default:D=-1}switch(D){case Ge.DOLLY:if(n.enableZoom===!1)return;F(b),r=s.DOLLY;break;case Ge.ROTATE:if(b.ctrlKey||b.metaKey||b.shiftKey){if(n.enablePan===!1)return;H(b),r=s.PAN}else{if(n.enableRotate===!1)return;N(b),r=s.ROTATE}break;case Ge.PAN:if(b.ctrlKey||b.metaKey||b.shiftKey){if(n.enableRotate===!1)return;N(b),r=s.ROTATE}else{if(n.enablePan===!1)return;H(b),r=s.PAN}break;default:r=s.NONE}r!==s.NONE&&n.dispatchEvent(Un)}function Vr(b){if(n.enabled!==!1)switch(r){case s.ROTATE:if(n.enableRotate===!1)return;$(b);break;case s.DOLLY:if(n.enableZoom===!1)return;oe(b);break;case s.PAN:if(n.enablePan===!1)return;X(b);break}}function Ns(b){n.enabled===!1||n.enableZoom===!1||r!==s.NONE||(b.preventDefault(),n.dispatchEvent(Un),se(b),n.dispatchEvent(Zs))}function Os(b){n.enabled===!1||n.enablePan===!1||we(b)}function Kr(b){switch(Bs(b),E.length){case 1:switch(n.touches.ONE){case vt.ROTATE:if(n.enableRotate===!1)return;ae(),r=s.TOUCH_ROTATE;break;case vt.PAN:if(n.enablePan===!1)return;ue(),r=s.TOUCH_PAN;break;default:r=s.NONE}break;case 2:switch(n.touches.TWO){case vt.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;it(),r=s.TOUCH_DOLLY_PAN;break;case vt.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Ze(),r=s.TOUCH_DOLLY_ROTATE;break;default:r=s.NONE}break;default:r=s.NONE}r!==s.NONE&&n.dispatchEvent(Un)}function Yr(b){switch(Bs(b),r){case s.TOUCH_ROTATE:if(n.enableRotate===!1)return;hn(b),n.update();break;case s.TOUCH_PAN:if(n.enablePan===!1)return;zt(b),n.update();break;case s.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;pn(b),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Xr(b),n.update();break;default:r=s.NONE}}function Fs(b){n.enabled!==!1&&b.preventDefault()}function Zr(b){E.push(b)}function js(b){delete _[b.pointerId];for(let D=0;D<E.length;D++)if(E[D].pointerId==b.pointerId){E.splice(D,1);return}}function Bs(b){let D=_[b.pointerId];D===void 0&&(D=new he,_[b.pointerId]=D),D.set(b.pageX,b.pageY)}function Bn(b){const D=b.pointerId===E[0].pointerId?E[1]:E[0];return _[D.pointerId]}n.domElement.addEventListener("contextmenu",Fs),n.domElement.addEventListener("pointerdown",gt),n.domElement.addEventListener("pointercancel",Ds),n.domElement.addEventListener("wheel",Ns,{passive:!1}),this.update()}}const ct=new xt,Se=new A,We=new A,te=new de,Ws={X:new A(1,0,0),Y:new A(0,1,0),Z:new A(0,0,1)},Gn={type:"change"},Qs={type:"mouseDown"},Js={type:"mouseUp",mode:null},eo={type:"objectChange"};class Xo extends qe{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new qo;this._gizmo=n,this.add(n);const s=new Vo;this._plane=s,this.add(s);const r=this;function i(y,v){let S=v;Object.defineProperty(r,y,{get:function(){return S!==void 0?S:v},set:function(E){S!==E&&(S=E,s[y]=E,n[y]=E,r.dispatchEvent({type:y+"-changed",value:E}),r.dispatchEvent(Gn))}}),r[y]=v,s[y]=v,n[y]=v}i("camera",e),i("object",void 0),i("enabled",!0),i("axis",null),i("mode","translate"),i("translationSnap",null),i("rotationSnap",null),i("scaleSnap",null),i("space","world"),i("size",1),i("dragging",!1),i("showX",!0),i("showY",!0),i("showZ",!0);const a=new A,c=new A,l=new de,h=new de,u=new A,p=new de,f=new A,d=new A,m=new A,g=0,w=new A;i("worldPosition",a),i("worldPositionStart",c),i("worldQuaternion",l),i("worldQuaternionStart",h),i("cameraPosition",u),i("cameraQuaternion",p),i("pointStart",f),i("pointEnd",d),i("rotationAxis",m),i("rotationAngle",g),i("eye",w),this._offset=new A,this._startNorm=new A,this._endNorm=new A,this._cameraScale=new A,this._parentPosition=new A,this._parentQuaternion=new de,this._parentQuaternionInv=new de,this._parentScale=new A,this._worldScaleStart=new A,this._worldQuaternionInv=new de,this._worldScale=new A,this._positionStart=new A,this._quaternionStart=new de,this._scaleStart=new A,this._getPointer=Ni.bind(this),this._onPointerDown=Fi.bind(this),this._onPointerHover=Oi.bind(this),this._onPointerMove=ji.bind(this),this._onPointerUp=Bi.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;ct.setFromCamera(e,this.camera);const t=Hn(this._gizmo.picker[this.mode],ct);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){ct.setFromCamera(e,this.camera);const t=Hn(this._plane,ct,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Qs.mode=this.mode,this.dispatchEvent(Qs)}}pointerMove(e){const t=this.axis,n=this.mode,s=this.object;let r=this.space;if(n==="scale"?r="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(r="world"),s===void 0||t===null||this.dragging===!1||e.button!==-1)return;ct.setFromCamera(e,this.camera);const i=Hn(this._plane,ct,!0);if(!!i){if(this.pointEnd.copy(i.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(s.position.applyQuaternion(te.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),r==="world"&&(s.parent&&s.position.add(Se.setFromMatrixPosition(s.parent.matrixWorld)),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(Se.setFromMatrixPosition(s.parent.matrixWorld))));else if(n==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),We.set(a,a,a)}else Se.copy(this.pointStart),We.copy(this.pointEnd),Se.applyQuaternion(this._worldQuaternionInv),We.applyQuaternion(this._worldQuaternionInv),We.divide(Se),t.search("X")===-1&&(We.x=1),t.search("Y")===-1&&(We.y=1),t.search("Z")===-1&&(We.z=1);s.scale.copy(this._scaleStart).multiply(We),this.scaleSnap&&(t.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(Se.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Se.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(Ws[t]),Se.copy(Ws[t]),r==="local"&&Se.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Se.cross(this.eye).normalize())*a),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&t!=="E"&&t!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(te.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(te.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Gn),this.dispatchEvent(eo)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(Js.mode=this.mode,this.dispatchEvent(Js)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){!this.enabled||this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Gn),this.dispatchEvent(eo),this.pointStart.copy(this.pointEnd))}getRaycaster(){return ct}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}update(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}Xo.prototype.isTransformControls=!0;function Ni(o){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:o.button};{const e=this.domElement.getBoundingClientRect();return{x:(o.clientX-e.left)/e.width*2-1,y:-(o.clientY-e.top)/e.height*2+1,button:o.button}}}function Oi(o){if(!!this.enabled)switch(o.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(o));break}}function Fi(o){!this.enabled||(document.pointerLockElement||this.domElement.setPointerCapture(o.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(o)),this.pointerDown(this._getPointer(o)))}function ji(o){!this.enabled||this.pointerMove(this._getPointer(o))}function Bi(o){!this.enabled||(this.domElement.releasePointerCapture(o.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(o)))}function Hn(o,e,t){const n=e.intersectObject(o,!0);for(let s=0;s<n.length;s++)if(n[s].object.visible||t)return n[s];return!1}const mn=new ht,W=new A(0,1,0),to=new A(0,0,0),no=new Q,gn=new de,Sn=new de,Re=new A,so=new Q,Vt=new A(1,0,0),lt=new A(0,1,0),Kt=new A(0,0,1),yn=new A,Ht=new A,$t=new A;class qo extends qe{constructor(){super(),this.type="TransformControlsGizmo";const e=new He({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new fs({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const s=t.clone();s.opacity=.5;const r=e.clone();r.color.setHex(16711680);const i=e.clone();i.color.setHex(65280);const a=e.clone();a.color.setHex(255);const c=e.clone();c.color.setHex(16711680),c.opacity=.5;const l=e.clone();l.color.setHex(65280),l.opacity=.5;const h=e.clone();h.color.setHex(255),h.opacity=.5;const u=e.clone();u.opacity=.25;const p=e.clone();p.color.setHex(16776960),p.opacity=.25,e.clone().color.setHex(16776960);const d=e.clone();d.color.setHex(7895160);const m=new ye(0,.04,.1,12);m.translate(0,.05,0);const g=new fe(.08,.08,.08);g.translate(0,.04,0);const w=new $e;w.setAttribute("position",new tt([0,0,0,1,0,0],3));const y=new ye(.0075,.0075,.5,3);y.translate(0,.25,0);function v(k,N){const F=new Gt(k,.0075,3,64,N*Math.PI*2);return F.rotateY(Math.PI/2),F.rotateX(Math.PI/2),F}function S(){const k=new $e;return k.setAttribute("position",new tt([0,0,0,1,1,1],3)),k}const E={X:[[new L(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new L(m,r),[-.5,0,0],[0,0,Math.PI/2]],[new L(y,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new L(m,i),[0,.5,0]],[new L(m,i),[0,-.5,0],[Math.PI,0,0]],[new L(y,i)]],Z:[[new L(m,a),[0,0,.5],[Math.PI/2,0,0]],[new L(m,a),[0,0,-.5],[-Math.PI/2,0,0]],[new L(y,a),null,[Math.PI/2,0,0]]],XYZ:[[new L(new dn(.1,0),u.clone()),[0,0,0]]],XY:[[new L(new fe(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new L(new fe(.15,.15,.01),c.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new L(new fe(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},_={X:[[new L(new ye(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new L(new ye(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new L(new ye(.2,0,.6,4),n),[0,.3,0]],[new L(new ye(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new L(new ye(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new L(new ye(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new L(new dn(.2,0),n)]],XY:[[new L(new fe(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new L(new fe(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new L(new fe(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},T={START:[[new L(new dn(.01,2),s),null,null,null,"helper"]],END:[[new L(new dn(.01,2),s),null,null,null,"helper"]],DELTA:[[new ke(S(),s),null,null,null,"helper"]],X:[[new ke(w,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new ke(w,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new ke(w,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={XYZE:[[new L(v(.5,1),d),null,[0,Math.PI/2,0]]],X:[[new L(v(.5,.5),r)]],Y:[[new L(v(.5,.5),i),null,[0,0,-Math.PI/2]]],Z:[[new L(v(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new L(v(.75,1),p),null,[0,Math.PI/2,0]]]},R={AXIS:[[new ke(w,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},x={XYZE:[[new L(new ni(.25,10,8),n)]],X:[[new L(new Gt(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new L(new Gt(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new L(new Gt(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new L(new Gt(.75,.1,2,24),n)]]},O={X:[[new L(g,r),[.5,0,0],[0,0,-Math.PI/2]],[new L(y,r),[0,0,0],[0,0,-Math.PI/2]],[new L(g,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new L(g,i),[0,.5,0]],[new L(y,i)],[new L(g,i),[0,-.5,0],[0,0,Math.PI]]],Z:[[new L(g,a),[0,0,.5],[Math.PI/2,0,0]],[new L(y,a),[0,0,0],[Math.PI/2,0,0]],[new L(g,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new L(new fe(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new L(new fe(.15,.15,.01),c),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new L(new fe(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new L(new fe(.1,.1,.1),u.clone())]]},C={X:[[new L(new ye(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new L(new ye(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new L(new ye(.2,0,.6,4),n),[0,.3,0]],[new L(new ye(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new L(new ye(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new L(new ye(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new L(new fe(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new L(new fe(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new L(new fe(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new L(new fe(.2,.2,.2),n),[0,0,0]]]},I={X:[[new ke(w,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new ke(w,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new ke(w,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function P(k){const N=new qe;for(const F in k)for(let H=k[F].length;H--;){const $=k[F][H][0].clone(),oe=k[F][H][1],X=k[F][H][2],se=k[F][H][3],we=k[F][H][4];$.name=F,$.tag=we,oe&&$.position.set(oe[0],oe[1],oe[2]),X&&$.rotation.set(X[0],X[1],X[2]),se&&$.scale.set(se[0],se[1],se[2]),$.updateMatrix();const ae=$.geometry.clone();ae.applyMatrix4($.matrix),$.geometry=ae,$.renderOrder=1/0,$.position.set(0,0,0),$.rotation.set(0,0,0),$.scale.set(1,1,1),N.add($)}return N}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=P(E)),this.add(this.gizmo.rotate=P(M)),this.add(this.gizmo.scale=P(O)),this.add(this.picker.translate=P(_)),this.add(this.picker.rotate=P(x)),this.add(this.picker.scale=P(C)),this.add(this.helper.translate=P(T)),this.add(this.helper.rotate=P(R)),this.add(this.helper.scale=P(I)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const n=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Sn;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let r=0;r<s.length;r++){const i=s[r];i.visible=!0,i.rotation.set(0,0,0),i.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),i.scale.set(1,1,1).multiplyScalar(a*this.size/4),i.tag==="helper"){i.visible=!1,i.name==="AXIS"?(i.position.copy(this.worldPositionStart),i.visible=!!this.axis,this.axis==="X"&&(te.setFromEuler(mn.set(0,0,0)),i.quaternion.copy(n).multiply(te),Math.abs(W.copy(Vt).applyQuaternion(n).dot(this.eye))>.9&&(i.visible=!1)),this.axis==="Y"&&(te.setFromEuler(mn.set(0,0,Math.PI/2)),i.quaternion.copy(n).multiply(te),Math.abs(W.copy(lt).applyQuaternion(n).dot(this.eye))>.9&&(i.visible=!1)),this.axis==="Z"&&(te.setFromEuler(mn.set(0,Math.PI/2,0)),i.quaternion.copy(n).multiply(te),Math.abs(W.copy(Kt).applyQuaternion(n).dot(this.eye))>.9&&(i.visible=!1)),this.axis==="XYZE"&&(te.setFromEuler(mn.set(0,Math.PI/2,0)),W.copy(this.rotationAxis),i.quaternion.setFromRotationMatrix(no.lookAt(to,W,lt)),i.quaternion.multiply(te),i.visible=this.dragging),this.axis==="E"&&(i.visible=!1)):i.name==="START"?(i.position.copy(this.worldPositionStart),i.visible=this.dragging):i.name==="END"?(i.position.copy(this.worldPosition),i.visible=this.dragging):i.name==="DELTA"?(i.position.copy(this.worldPositionStart),i.quaternion.copy(this.worldQuaternionStart),Se.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Se.applyQuaternion(this.worldQuaternionStart.clone().invert()),i.scale.copy(Se),i.visible=this.dragging):(i.quaternion.copy(n),this.dragging?i.position.copy(this.worldPositionStart):i.position.copy(this.worldPosition),this.axis&&(i.visible=this.axis.search(i.name)!==-1));continue}i.quaternion.copy(n),this.mode==="translate"||this.mode==="scale"?(i.name==="X"&&Math.abs(W.copy(Vt).applyQuaternion(n).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="Y"&&Math.abs(W.copy(lt).applyQuaternion(n).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="Z"&&Math.abs(W.copy(Kt).applyQuaternion(n).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="XY"&&Math.abs(W.copy(Kt).applyQuaternion(n).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="YZ"&&Math.abs(W.copy(Vt).applyQuaternion(n).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="XZ"&&Math.abs(W.copy(lt).applyQuaternion(n).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1)):this.mode==="rotate"&&(gn.copy(n),W.copy(this.eye).applyQuaternion(te.copy(n).invert()),i.name.search("E")!==-1&&i.quaternion.setFromRotationMatrix(no.lookAt(this.eye,to,lt)),i.name==="X"&&(te.setFromAxisAngle(Vt,Math.atan2(-W.y,W.z)),te.multiplyQuaternions(gn,te),i.quaternion.copy(te)),i.name==="Y"&&(te.setFromAxisAngle(lt,Math.atan2(W.x,W.z)),te.multiplyQuaternions(gn,te),i.quaternion.copy(te)),i.name==="Z"&&(te.setFromAxisAngle(Kt,Math.atan2(W.y,W.x)),te.multiplyQuaternions(gn,te),i.quaternion.copy(te))),i.visible=i.visible&&(i.name.indexOf("X")===-1||this.showX),i.visible=i.visible&&(i.name.indexOf("Y")===-1||this.showY),i.visible=i.visible&&(i.name.indexOf("Z")===-1||this.showZ),i.visible=i.visible&&(i.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),i.material._color=i.material._color||i.material.color.clone(),i.material._opacity=i.material._opacity||i.material.opacity,i.material.color.copy(i.material._color),i.material.opacity=i.material._opacity,this.enabled&&this.axis&&(i.name===this.axis||this.axis.split("").some(function(c){return i.name===c}))&&(i.material.color.setHex(16776960),i.material.opacity=1)}super.updateMatrixWorld(e)}}qo.prototype.isTransformControlsGizmo=!0;class Vo extends L{constructor(){super(new Zn(1e5,1e5,2,2),new He({visible:!1,wireframe:!0,side:Io,transparent:!0,opacity:.1,toneMapped:!1})),this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),yn.copy(Vt).applyQuaternion(t==="local"?this.worldQuaternion:Sn),Ht.copy(lt).applyQuaternion(t==="local"?this.worldQuaternion:Sn),$t.copy(Kt).applyQuaternion(t==="local"?this.worldQuaternion:Sn),W.copy(Ht),this.mode){case"translate":case"scale":switch(this.axis){case"X":W.copy(this.eye).cross(yn),Re.copy(yn).cross(W);break;case"Y":W.copy(this.eye).cross(Ht),Re.copy(Ht).cross(W);break;case"Z":W.copy(this.eye).cross($t),Re.copy($t).cross(W);break;case"XY":Re.copy($t);break;case"YZ":Re.copy(yn);break;case"XZ":W.copy($t),Re.copy(Ht);break;case"XYZ":case"E":Re.set(0,0,0);break}break;case"rotate":default:Re.set(0,0,0)}Re.length()===0?this.quaternion.copy(this.cameraQuaternion):(so.lookAt(Se.set(0,0,0),Re,W),this.quaternion.setFromRotationMatrix(so)),super.updateMatrixWorld(e)}}Vo.prototype.isTransformControlsPlane=!0;const wt=new ht(0,0,0,"YXZ"),bt=new A,zi={type:"change"},Ui={type:"lock"},Gi={type:"unlock"},oo=Math.PI/2;class Hi extends ps{constructor(e,t){super(),t===void 0&&(console.warn('THREE.PointerLockControls: The second parameter "domElement" is now mandatory.'),t=document.body),this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1;const n=this;function s(a){if(n.isLocked===!1)return;const c=a.movementX||a.mozMovementX||a.webkitMovementX||0,l=a.movementY||a.mozMovementY||a.webkitMovementY||0;wt.setFromQuaternion(e.quaternion),wt.y-=c*.002*n.pointerSpeed,wt.x-=l*.002*n.pointerSpeed,wt.x=Math.max(oo-n.maxPolarAngle,Math.min(oo-n.minPolarAngle,wt.x)),e.quaternion.setFromEuler(wt),n.dispatchEvent(zi)}function r(){n.domElement.ownerDocument.pointerLockElement===n.domElement?(n.dispatchEvent(Ui),n.isLocked=!0):(n.dispatchEvent(Gi),n.isLocked=!1)}function i(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}this.connect=function(){n.domElement.ownerDocument.addEventListener("mousemove",s),n.domElement.ownerDocument.addEventListener("pointerlockchange",r),n.domElement.ownerDocument.addEventListener("pointerlockerror",i)},this.disconnect=function(){n.domElement.ownerDocument.removeEventListener("mousemove",s),n.domElement.ownerDocument.removeEventListener("pointerlockchange",r),n.domElement.ownerDocument.removeEventListener("pointerlockerror",i)},this.dispose=function(){this.disconnect()},this.getObject=function(){return e},this.getDirection=function(){const a=new A(0,0,-1);return function(c){return c.copy(a).applyQuaternion(e.quaternion)}}(),this.moveForward=function(a){bt.setFromMatrixColumn(e.matrix,0),bt.crossVectors(e.up,bt),e.position.addScaledVector(bt,a)},this.moveRight=function(a){bt.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(bt,a)},this.lock=function(){this.domElement.requestPointerLock()},this.unlock=function(){n.domElement.ownerDocument.exitPointerLock()},this.connect()}}class $i{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){const n=[],s=Xi(e,t,this.data);for(let r=0,i=s.length;r<i;r++)Array.prototype.push.apply(n,s[r].toShapes());return n}}function Xi(o,e,t){const n=Array.from(o),s=e/t.resolution,r=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*s,i=[];let a=0,c=0;for(let l=0;l<n.length;l++){const h=n[l];if(h===`
`)a=0,c-=r;else{const u=qi(h,s,a,c,t);a+=u.offsetX,i.push(u.path)}}return i}function qi(o,e,t,n,s){const r=s.glyphs[o]||s.glyphs["?"];if(!r){console.error('THREE.Font: character "'+o+'" does not exists in font family '+s.familyName+".");return}const i=new si;let a,c,l,h,u,p,f,d;if(r.o){const m=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let g=0,w=m.length;g<w;)switch(m[g++]){case"m":a=m[g++]*e+t,c=m[g++]*e+n,i.moveTo(a,c);break;case"l":a=m[g++]*e+t,c=m[g++]*e+n,i.lineTo(a,c);break;case"q":l=m[g++]*e+t,h=m[g++]*e+n,u=m[g++]*e+t,p=m[g++]*e+n,i.quadraticCurveTo(u,p,l,h);break;case"b":l=m[g++]*e+t,h=m[g++]*e+n,u=m[g++]*e+t,p=m[g++]*e+n,f=m[g++]*e+t,d=m[g++]*e+n,i.bezierCurveTo(u,p,f,d,l,h);break}}return{offsetX:r.ha*e,path:i}}$i.prototype.isFont=!0;class Vi extends Lo{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Wi(t)}),this.register(function(t){return new sa(t)}),this.register(function(t){return new oa(t)}),this.register(function(t){return new Qi(t)}),this.register(function(t){return new Ji(t)}),this.register(function(t){return new ea(t)}),this.register(function(t){return new ta(t)}),this.register(function(t){return new na(t)}),this.register(function(t){return new Yi(t)}),this.register(function(t){return new ra(t)})}load(e,t,n,s){const r=this;let i;this.resourcePath!==""?i=this.resourcePath:this.path!==""?i=this.path:i=Ne.extractUrlBase(e),this.manager.itemStart(e);const a=function(l){s?s(l):console.error(l),r.manager.itemError(e),r.manager.itemEnd(e)},c=new ds(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{r.parse(l,i,function(h){t(h),r.manager.itemEnd(e)},a)}catch(h){a(h)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let r;const i={},a={};if(typeof e=="string")r=e;else if(Ne.decodeText(new Uint8Array(e,0,4))===Ko){try{i[G.KHR_BINARY_GLTF]=new ia(e)}catch(u){s&&s(u);return}r=i[G.KHR_BINARY_GLTF].content}else r=Ne.decodeText(new Uint8Array(e));const c=JSON.parse(r);if(c.asset===void 0||c.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new wa(c,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](l);a[u.name]=u,i[u.name]=!0}if(c.extensionsUsed)for(let h=0;h<c.extensionsUsed.length;++h){const u=c.extensionsUsed[h],p=c.extensionsRequired||[];switch(u){case G.KHR_MATERIALS_UNLIT:i[u]=new Zi;break;case G.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:i[u]=new la;break;case G.KHR_DRACO_MESH_COMPRESSION:i[u]=new aa(c,this.dracoLoader);break;case G.KHR_TEXTURE_TRANSFORM:i[u]=new ca;break;case G.KHR_MESH_QUANTIZATION:i[u]=new ua;break;default:p.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(i),l.setPlugins(a),l.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,r){n.parse(e,t,s,r)})}}function Ki(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const G={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Yi{constructor(e){this.parser=e,this.name=G.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const r=t.json,c=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let l;const h=new ne(16777215);c.color!==void 0&&h.fromArray(c.color);const u=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new gs(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new _n(h),l.distance=u;break;case"spot":l=new ms(h),l.distance=u,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,c.intensity!==void 0&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),s=Promise.resolve(l),t.cache.add(n,s),s}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return n._getNodeRef(t.cache,a,c)})}}class Zi{constructor(){this.name=G.KHR_MATERIALS_UNLIT}getMaterialType(){return He}extendParams(e,t,n){const s=[];e.color=new ne(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const i=r.baseColorFactor;e.color.fromArray(i),e.opacity=i[3]}r.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",r.baseColorTexture))}return Promise.all(s)}}class Wi{constructor(e){this.parser=e,this.name=G.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Lt}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],i=s.extensions[this.name];if(i.clearcoatFactor!==void 0&&(t.clearcoat=i.clearcoatFactor),i.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",i.clearcoatTexture)),i.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=i.clearcoatRoughnessFactor),i.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),i.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",i.clearcoatNormalTexture)),i.clearcoatNormalTexture.scale!==void 0)){const a=i.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new he(a,a)}return Promise.all(r)}}class Qi{constructor(e){this.parser=e,this.name=G.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Lt}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new ne(0,0,0),t.sheenRoughness=0,t.sheen=1;const i=s.extensions[this.name];return i.sheenColorFactor!==void 0&&t.sheenColor.fromArray(i.sheenColorFactor),i.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=i.sheenRoughnessFactor),i.sheenColorTexture!==void 0&&r.push(n.assignTexture(t,"sheenColorMap",i.sheenColorTexture)),i.sheenRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(r)}}class Ji{constructor(e){this.parser=e,this.name=G.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Lt}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],i=s.extensions[this.name];return i.transmissionFactor!==void 0&&(t.transmission=i.transmissionFactor),i.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(r)}}class ea{constructor(e){this.parser=e,this.name=G.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Lt}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],i=s.extensions[this.name];t.thickness=i.thicknessFactor!==void 0?i.thicknessFactor:0,i.thicknessTexture!==void 0&&r.push(n.assignTexture(t,"thicknessMap",i.thicknessTexture)),t.attenuationDistance=i.attenuationDistance||0;const a=i.attenuationColor||[1,1,1];return t.attenuationColor=new ne(a[0],a[1],a[2]),Promise.all(r)}}class ta{constructor(e){this.parser=e,this.name=G.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Lt}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class na{constructor(e){this.parser=e,this.name=G.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Lt}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],i=s.extensions[this.name];t.specularIntensity=i.specularFactor!==void 0?i.specularFactor:1,i.specularTexture!==void 0&&r.push(n.assignTexture(t,"specularIntensityMap",i.specularTexture));const a=i.specularColorFactor||[1,1,1];return t.specularColor=new ne(a[0],a[1],a[2]),i.specularColorTexture!==void 0&&r.push(n.assignTexture(t,"specularColorMap",i.specularColorTexture).then(function(c){c.encoding=De})),Promise.all(r)}}class sa{constructor(e){this.parser=e,this.name=G.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],i=t.options.ktx2Loader;if(!i){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,i)}}class oa{constructor(e){this.parser=e,this.name=G.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const i=r.extensions[t],a=s.images[i.source];let c=n.textureLoader;if(a.uri){const l=n.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,a,c);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class ra{constructor(e){this.name=G.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,i.ready]).then(function(a){const c=s.byteOffset||0,l=s.byteLength||0,h=s.count,u=s.byteStride,p=new ArrayBuffer(h*u),f=new Uint8Array(a[0],c,l);return i.decodeGltfBuffer(new Uint8Array(p),h,u,f,s.mode,s.filter),p})}else return null}}const Ko="glTF",Xt=12,ro={JSON:1313821514,BIN:5130562};class ia{constructor(e){this.name=G.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Xt);if(this.header={magic:Ne.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Ko)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-Xt,s=new DataView(e,Xt);let r=0;for(;r<n;){const i=s.getUint32(r,!0);r+=4;const a=s.getUint32(r,!0);if(r+=4,a===ro.JSON){const c=new Uint8Array(e,Xt+r,i);this.content=Ne.decodeText(c)}else if(a===ro.BIN){const c=Xt+r;this.body=e.slice(c,c+i)}r+=i}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class aa{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=G.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,a={},c={},l={};for(const h in i){const u=ss[h]||h.toLowerCase();a[u]=i[h]}for(const h in e.attributes){const u=ss[h]||h.toLowerCase();if(i[h]!==void 0){const p=n.accessors[e.attributes[h]],f=Jt[p.componentType];l[u]=f,c[u]=p.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(u){s.decodeDracoFile(h,function(p){for(const f in p.attributes){const d=p.attributes[f],m=c[f];m!==void 0&&(d.normalized=m)}u(p)},a,l)})})}}class ca{constructor(){this.name=G.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class ns extends ys{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),s=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),i=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new ne().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(c){for(const l in a)c.uniforms[l]=a[l];c.fragmentShader=c.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",s).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",i)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(c){a.specular.value=c}},specularMap:{get:function(){return a.specularMap.value},set:function(c){a.specularMap.value=c,c?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(c){a.glossiness.value=c}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(c){a.glossinessMap.value=c,c?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class la{constructor(){this.name=G.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return ns}extendParams(e,t,n){const s=t.extensions[this.name];e.color=new ne(1,1,1),e.opacity=1;const r=[];if(Array.isArray(s.diffuseFactor)){const i=s.diffuseFactor;e.color.fromArray(i),e.opacity=i[3]}if(s.diffuseTexture!==void 0&&r.push(n.assignTexture(e,"map",s.diffuseTexture)),e.emissive=new ne(0,0,0),e.glossiness=s.glossinessFactor!==void 0?s.glossinessFactor:1,e.specular=new ne(1,1,1),Array.isArray(s.specularFactor)&&e.specular.fromArray(s.specularFactor),s.specularGlossinessTexture!==void 0){const i=s.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",i)),r.push(n.assignTexture(e,"specularMap",i))}return Promise.all(r)}createMaterial(e){const t=new ns(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=oi,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class ua{constructor(){this.name=G.KHR_MESH_QUANTIZATION}}class ft extends ri{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let i=0;i!==s;i++)t[i]=n[r+i];return t}}ft.prototype.beforeStart_=ft.prototype.copySampleValue_;ft.prototype.afterEnd_=ft.prototype.copySampleValue_;ft.prototype.interpolate_=function(o,e,t,n){const s=this.resultBuffer,r=this.sampleValues,i=this.valueSize,a=i*2,c=i*3,l=n-e,h=(t-e)/l,u=h*h,p=u*h,f=o*c,d=f-c,m=-2*p+3*u,g=p-u,w=1-m,y=g-u+h;for(let v=0;v!==i;v++){const S=r[d+v+i],E=r[d+v+a]*l,_=r[f+v+i],T=r[f+v]*l;s[v]=w*S+y*E+m*_+g*T}return s};const ha=new de;class pa extends ft{interpolate_(e,t,n,s){const r=super.interpolate_(e,t,n,s);return ha.fromArray(r).normalize().toArray(r),r}}const ze={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Jt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},io={9728:ii,9729:Po,9984:ai,9985:ci,9986:li,9987:Ro},ao={33071:Wn,33648:ui,10497:Zt},co={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ss={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Qe={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},fa={CUBICSPLINE:void 0,LINEAR:Co,STEP:hi},$n={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function da(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new ys({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:bi})),o.DefaultMaterial}function qt(o,e,t){for(const n in t.extensions)o[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function ut(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function ma(o,e,t){let n=!1,s=!1,r=!1;for(let l=0,h=e.length;l<h;l++){const u=e[l];if(u.POSITION!==void 0&&(n=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(o);const i=[],a=[],c=[];for(let l=0,h=e.length;l<h;l++){const u=e[l];if(n){const p=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):o.attributes.position;i.push(p)}if(s){const p=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):o.attributes.normal;a.push(p)}if(r){const p=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):o.attributes.color;c.push(p)}}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[0],u=l[1],p=l[2];return n&&(o.morphAttributes.position=h),s&&(o.morphAttributes.normal=u),r&&(o.morphAttributes.color=p),o.morphTargetsRelative=!0,o})}function ga(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)o.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ya(o){const e=o.extensions&&o.extensions[G.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+lo(e.attributes):t=o.indices+":"+lo(o.attributes)+":"+o.mode,t}function lo(o){let e="";const t=Object.keys(o).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+o[t[n]]+";";return e}function os(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function va(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class wa{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Ki,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap!="undefined"&&/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!1?this.textureLoader=new pi(this.options.manager):this.textureLoader=new vs(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ds(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(i){return i._markDefs&&i._markDefs()}),Promise.all(this._invokeAll(function(i){return i.beforeRoot&&i.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(i){const a={scene:i[0][s.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:s.asset,parser:n,userData:{}};qt(r,a,s),ut(a,s),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const i=t[s].joints;for(let a=0,c=i.length;a<c;a++)e[i[a]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const i=e[s];i.mesh!==void 0&&(this._addNodeRef(this.meshCache,i.mesh),i.skin!==void 0&&(n[i.mesh].isSkinnedMesh=!0)),i.camera!==void 0&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),r=(i,a)=>{const c=this.associations.get(i);c!=null&&this.associations.set(a,c);for(const[l,h]of i.children.entries())r(h,a.children[l])};return r(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this.loadNode(t);break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this.loadAnimation(t);break;case"camera":s=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,i){return n.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[G.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,i){n.load(Ne.resolveURL(t.uri,s.path),r,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0)return Promise.resolve(null);const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(i){const a=i[0],c=co[s.type],l=Jt[s.componentType],h=l.BYTES_PER_ELEMENT,u=h*c,p=s.byteOffset||0,f=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,d=s.normalized===!0;let m,g;if(f&&f!==u){const w=Math.floor(p/f),y="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+w+":"+s.count;let v=t.cache.get(y);v||(m=new l(a,w*f,s.count*f/h),v=new fi(m,f/h),t.cache.add(y,v)),g=new di(v,c,p%f/h,d)}else a===null?m=new l(s.count*c):m=new l(a,p,s.count*c),g=new $s(m,c,d);if(s.sparse!==void 0){const w=co.SCALAR,y=Jt[s.sparse.indices.componentType],v=s.sparse.indices.byteOffset||0,S=s.sparse.values.byteOffset||0,E=new y(i[1],v,s.sparse.count*w),_=new l(i[2],S,s.sparse.count*c);a!==null&&(g=new $s(g.array.slice(),g.itemSize,g.normalized));for(let T=0,M=E.length;T<M;T++){const R=E[T];if(g.setX(R,_[T*c]),c>=2&&g.setY(R,_[T*c+1]),c>=3&&g.setZ(R,_[T*c+2]),c>=4&&g.setW(R,_[T*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,i=t.images[r];let a=this.textureLoader;if(i.uri){const c=n.manager.getHandler(i.uri);c!==null&&(a=c)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,n){const s=this,r=this.json,i=r.textures[e],a=r.images[t],c=(a.uri||a.bufferView)+":"+i.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,n).then(function(h){h.flipY=!1,i.name&&(h.name=i.name);const p=(r.samplers||{})[i.sampler]||{};return h.magFilter=io[p.magFilter]||Po,h.minFilter=io[p.minFilter]||Ro,h.wrapS=ao[p.wrapS]||Zt,h.wrapT=ao[p.wrapT]||Zt,s.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const n=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(function(u){return u.clone()}).catch(function(u){throw u});const i=s.images[e],a=self.URL||self.webkitURL;let c=i.uri||"",l=!1;if(i.bufferView!==void 0)c=n.getDependency("bufferView",i.bufferView).then(function(u){l=!0;const p=new Blob([u],{type:i.mimeType});return c=a.createObjectURL(p),c});else if(i.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(c).then(function(u){return new Promise(function(p,f){let d=p;t.isImageBitmapLoader===!0&&(d=function(m){const g=new Qt(m);g.needsUpdate=!0,p(g)}),t.load(Ne.resolveURL(u,r.path),d,void 0,f)})}).then(function(u){return l===!0&&a.revokeObjectURL(c),u.userData.mimeType=i.mimeType||va(i.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),u});return this.sourceCache[e]=h,h}assignTexture(e,t,n){const s=this;return this.getDependency("texture",n.index).then(function(r){if(n.texCoord!==void 0&&n.texCoord!=0&&!(t==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),s.extensions[G.KHR_TEXTURE_TRANSFORM]){const i=n.extensions!==void 0?n.extensions[G.KHR_TEXTURE_TRANSFORM]:void 0;if(i){const a=s.associations.get(r);r=s.extensions[G.KHR_TEXTURE_TRANSFORM].extendTexture(r,i),s.associations.set(r,a)}}return e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,i=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new mi,pt.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(a,c)),n=c}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new fs,pt.prototype.copy.call(c,n),c.color.copy(n.color),this.cache.add(a,c)),n=c}if(s||r||i){let a="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),s&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),i&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=n.clone(),r&&(c.vertexColors=!0),i&&(c.flatShading=!0),s&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(n))),n=c}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return ys}loadMaterial(e){const t=this,n=this.json,s=this.extensions,r=n.materials[e];let i;const a={},c=r.extensions||{},l=[];if(c[G.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const u=s[G.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];i=u.getMaterialType(),l.push(u.extendParams(a,r,t))}else if(c[G.KHR_MATERIALS_UNLIT]){const u=s[G.KHR_MATERIALS_UNLIT];i=u.getMaterialType(),l.push(u.extendParams(a,r,t))}else{const u=r.pbrMetallicRoughness||{};if(a.color=new ne(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const p=u.baseColorFactor;a.color.fromArray(p),a.opacity=p[3]}u.baseColorTexture!==void 0&&l.push(t.assignTexture(a,"map",u.baseColorTexture)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),i=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=Io);const h=r.alphaMode||$n.OPAQUE;if(h===$n.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===$n.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&i!==He&&(l.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new he(1,1),r.normalTexture.scale!==void 0)){const u=r.normalTexture.scale;a.normalScale.set(u,u)}return r.occlusionTexture!==void 0&&i!==He&&(l.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&i!==He&&(a.emissive=new ne().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&i!==He&&l.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture)),Promise.all(l).then(function(){let u;return i===ns?u=s[G.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):u=new i(a),r.name&&(u.name=r.name),u.map&&(u.map.encoding=De),u.emissiveMap&&(u.emissiveMap.encoding=De),u.sheenColorMap&&(u.sheenColorMap.encoding=De),u.specularColorMap&&(u.specularColorMap.encoding=De),u.specularMap&&(u.specularMap.encoding=De),ut(u,r),t.associations.set(u,{materials:e}),r.extensions&&qt(s,u,r),u})}createUniqueName(e){const t=Wt.sanitizeNodeName(e||"");let n=t;for(let s=1;this.nodeNamesUsed[n];++s)n=t+"_"+s;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function r(a){return n[G.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return uo(c,a,t)})}const i=[];for(let a=0,c=e.length;a<c;a++){const l=e[a],h=ya(l),u=s[h];if(u)i.push(u.promise);else{let p;l.extensions&&l.extensions[G.KHR_DRACO_MESH_COMPRESSION]?p=r(l):p=uo(new $e,l,t),s[h]={primitive:l,promise:p},i.push(p)}}return Promise.all(i)}loadMesh(e){const t=this,n=this.json,s=this.extensions,r=n.meshes[e],i=r.primitives,a=[];for(let c=0,l=i.length;c<l;c++){const h=i[c].material===void 0?da(this.cache):this.getDependency("material",i[c].material);a.push(h)}return a.push(t.loadGeometries(i)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),h=c[c.length-1],u=[];for(let f=0,d=h.length;f<d;f++){const m=h[f],g=i[f];let w;const y=l[f];if(g.mode===ze.TRIANGLES||g.mode===ze.TRIANGLE_STRIP||g.mode===ze.TRIANGLE_FAN||g.mode===void 0)w=r.isSkinnedMesh===!0?new ko(m,y):new L(m,y),w.isSkinnedMesh===!0&&!w.geometry.attributes.skinWeight.normalized&&w.normalizeSkinWeights(),g.mode===ze.TRIANGLE_STRIP?w.geometry=ho(w.geometry,gi):g.mode===ze.TRIANGLE_FAN&&(w.geometry=ho(w.geometry,Do));else if(g.mode===ze.LINES)w=new yi(m,y);else if(g.mode===ze.LINE_STRIP)w=new ke(m,y);else if(g.mode===ze.LINE_LOOP)w=new vi(m,y);else if(g.mode===ze.POINTS)w=new wi(m,y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(w.geometry.morphAttributes).length>0&&ga(w,r),w.name=t.createUniqueName(r.name||"mesh_"+e),ut(w,r),g.extensions&&qt(s,w,g),t.assignFinalMaterial(w),u.push(w)}for(let f=0,d=u.length;f<d;f++)t.associations.set(u[f],{meshes:e,primitives:f});if(u.length===1)return u[0];const p=new Tt;t.associations.set(p,{meshes:e});for(let f=0,d=u.length;f<d;f++)p.add(u[f]);return p})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new ws(Pe.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new No(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),ut(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(s){return n.inverseBindMatrices=s,n})}loadAnimation(e){const n=this.json.animations[e],s=[],r=[],i=[],a=[],c=[];for(let l=0,h=n.channels.length;l<h;l++){const u=n.channels[l],p=n.samplers[u.sampler],f=u.target,d=f.node!==void 0?f.node:f.id,m=n.parameters!==void 0?n.parameters[p.input]:p.input,g=n.parameters!==void 0?n.parameters[p.output]:p.output;s.push(this.getDependency("node",d)),r.push(this.getDependency("accessor",m)),i.push(this.getDependency("accessor",g)),a.push(p),c.push(f)}return Promise.all([Promise.all(s),Promise.all(r),Promise.all(i),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[0],u=l[1],p=l[2],f=l[3],d=l[4],m=[];for(let w=0,y=h.length;w<y;w++){const v=h[w],S=u[w],E=p[w],_=f[w],T=d[w];if(v===void 0)continue;v.updateMatrix(),v.matrixAutoUpdate=!0;let M;switch(Qe[T.path]){case Qe.weights:M=Fo;break;case Qe.rotation:M=Qn;break;case Qe.position:case Qe.scale:default:M=Oo;break}const R=v.name?v.name:v.uuid,x=_.interpolation!==void 0?fa[_.interpolation]:Co,O=[];Qe[T.path]===Qe.weights?v.traverse(function(I){I.morphTargetInfluences&&O.push(I.name?I.name:I.uuid)}):O.push(R);let C=E.array;if(E.normalized){const I=os(C.constructor),P=new Float32Array(C.length);for(let k=0,N=C.length;k<N;k++)P[k]=C[k]*I;C=P}for(let I=0,P=O.length;I<P;I++){const k=new M(O[I]+"."+Qe[T.path],S.array,C,x);_.interpolation==="CUBICSPLINE"&&(k.createInterpolant=function(F){const H=this instanceof Qn?pa:ft;return new H(this.times,this.values,this.getValueSize()/3,F)},k.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),m.push(k)}}const g=n.name?n.name:"animation_"+e;return new jo(g,void 0,m)})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(r){const i=n._getNodeRef(n.meshCache,s.mesh,r);return s.weights!==void 0&&i.traverse(function(a){if(!!a.isMesh)for(let c=0,l=s.weights.length;c<l;c++)a.morphTargetInfluences[c]=s.weights[c]}),i})}loadNode(e){const t=this.json,n=this.extensions,s=this,r=t.nodes[e],i=r.name?s.createUniqueName(r.name):"";return function(){const a=[],c=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&a.push(c),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(l){return s._getNodeRef(s.cameraCache,r.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),Promise.all(a)}().then(function(a){let c;if(r.isBone===!0?c=new Jn:a.length>1?c=new Tt:a.length===1?c=a[0]:c=new qe,c!==a[0])for(let l=0,h=a.length;l<h;l++)c.add(a[l]);if(r.name&&(c.userData.name=r.name,c.name=i),ut(c,r),r.extensions&&qt(n,c,r),r.matrix!==void 0){const l=new Q;l.fromArray(r.matrix),c.applyMatrix4(l)}else r.translation!==void 0&&c.position.fromArray(r.translation),r.rotation!==void 0&&c.quaternion.fromArray(r.rotation),r.scale!==void 0&&c.scale.fromArray(r.scale);return s.associations.has(c)||s.associations.set(c,{}),s.associations.get(c).nodes=e,c})}loadScene(e){const t=this.json,n=this.extensions,s=this.json.scenes[e],r=this,i=new Tt;s.name&&(i.name=r.createUniqueName(s.name)),ut(i,s),s.extensions&&qt(n,i,s);const a=s.nodes||[],c=[];for(let l=0,h=a.length;l<h;l++)c.push(Yo(a[l],i,t,r));return Promise.all(c).then(function(){const l=h=>{const u=new Map;for(const[p,f]of r.associations)(p instanceof pt||p instanceof Qt)&&u.set(p,f);return h.traverse(p=>{const f=r.associations.get(p);f!=null&&u.set(p,f)}),u};return r.associations=l(i),i})}}function Yo(o,e,t,n){const s=t.nodes[o];return n.getDependency("node",o).then(function(r){if(s.skin===void 0)return r;let i;return n.getDependency("skin",s.skin).then(function(a){i=a;const c=[];for(let l=0,h=i.joints.length;l<h;l++)c.push(n.getDependency("node",i.joints[l]));return Promise.all(c)}).then(function(a){return r.traverse(function(c){if(!c.isMesh)return;const l=[],h=[];for(let u=0,p=a.length;u<p;u++){const f=a[u];if(f){l.push(f);const d=new Q;i.inverseBindMatrices!==void 0&&d.fromArray(i.inverseBindMatrices.array,u*16),h.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[u])}c.bind(new Bo(l,h),c.matrixWorld)}),r})}).then(function(r){e.add(r);const i=[];if(s.children){const a=s.children;for(let c=0,l=a.length;c<l;c++){const h=a[c];i.push(Yo(h,r,t,n))}}return Promise.all(i)})}function ba(o,e,t){const n=e.attributes,s=new Ei;if(n.POSITION!==void 0){const a=t.json.accessors[n.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(s.set(new A(c[0],c[1],c[2]),new A(l[0],l[1],l[2])),a.normalized){const h=os(Jt[a.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new A,c=new A;for(let l=0,h=r.length;l<h;l++){const u=r[l];if(u.POSITION!==void 0){const p=t.json.accessors[u.POSITION],f=p.min,d=p.max;if(f!==void 0&&d!==void 0){if(c.setX(Math.max(Math.abs(f[0]),Math.abs(d[0]))),c.setY(Math.max(Math.abs(f[1]),Math.abs(d[1]))),c.setZ(Math.max(Math.abs(f[2]),Math.abs(d[2]))),p.normalized){const m=os(Jt[p.componentType]);c.multiplyScalar(m)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}o.boundingBox=s;const i=new Si;s.getCenter(i.center),i.radius=s.min.distanceTo(s.max)/2,o.boundingSphere=i}function uo(o,e,t){const n=e.attributes,s=[];function r(i,a){return t.getDependency("accessor",i).then(function(c){o.setAttribute(a,c)})}for(const i in n){const a=ss[i]||i.toLowerCase();a in o.attributes||s.push(r(n[i],a))}if(e.indices!==void 0&&!o.index){const i=t.getDependency("accessor",e.indices).then(function(a){o.setIndex(a)});s.push(i)}return ut(o,e),ba(o,e,t),Promise.all(s).then(function(){return e.targets!==void 0?ma(o,e.targets,t):o})}function ho(o,e){let t=o.getIndex();if(t===null){const i=[],a=o.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)i.push(c);o.setIndex(i),t=o.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const n=t.count-2,s=[];if(e===Do)for(let i=1;i<=n;i++)s.push(t.getX(0)),s.push(t.getX(i)),s.push(t.getX(i+1));else for(let i=0;i<n;i++)i%2===0?(s.push(t.getX(i)),s.push(t.getX(i+1)),s.push(t.getX(i+2))):(s.push(t.getX(i+2)),s.push(t.getX(i+1)),s.push(t.getX(i)));s.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=o.clone();return r.setIndex(s),r}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var po={},rs=function(o){return URL.createObjectURL(new Blob([o],{type:"text/javascript"}))},Zo=function(o){return new Worker(o)};try{URL.revokeObjectURL(rs(""))}catch{rs=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},Zo=function(e){return new Worker(e,{type:"module"})}}var Ea=function(o,e,t,n,s){var r=Zo(po[e]||(po[e]=rs(o)));return r.onerror=function(i){return s(i.error,null)},r.onmessage=function(i){return s(null,i.data)},r.postMessage(t,n),r},U=Uint8Array,me=Uint16Array,Ve=Uint32Array,Ct=new U([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),kt=new U([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),en=new U([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Wo=function(o,e){for(var t=new me(31),n=0;n<31;++n)t[n]=e+=1<<o[n-1];for(var s=new Ve(t[30]),n=1;n<30;++n)for(var r=t[n];r<t[n+1];++r)s[r]=r-t[n]<<5|n;return[t,s]},Qo=Wo(Ct,2),Es=Qo[0],An=Qo[1];Es[28]=258,An[258]=28;var Jo=Wo(kt,0),er=Jo[0],is=Jo[1],tn=new me(32768);for(var ee=0;ee<32768;++ee){var Je=(ee&43690)>>>1|(ee&21845)<<1;Je=(Je&52428)>>>2|(Je&13107)<<2,Je=(Je&61680)>>>4|(Je&3855)<<4,tn[ee]=((Je&65280)>>>8|(Je&255)<<8)>>>1}var _e=function(o,e,t){for(var n=o.length,s=0,r=new me(e);s<n;++s)++r[o[s]-1];var i=new me(e);for(s=0;s<e;++s)i[s]=i[s-1]+r[s-1]<<1;var a;if(t){a=new me(1<<e);var c=15-e;for(s=0;s<n;++s)if(o[s])for(var l=s<<4|o[s],h=e-o[s],u=i[o[s]-1]++<<h,p=u|(1<<h)-1;u<=p;++u)a[tn[u]>>>c]=l}else for(a=new me(n),s=0;s<n;++s)o[s]&&(a[s]=tn[i[o[s]-1]++]>>>15-o[s]);return a},Ke=new U(288);for(var ee=0;ee<144;++ee)Ke[ee]=8;for(var ee=144;ee<256;++ee)Ke[ee]=9;for(var ee=256;ee<280;++ee)Ke[ee]=7;for(var ee=280;ee<288;++ee)Ke[ee]=8;var _t=new U(32);for(var ee=0;ee<32;++ee)_t[ee]=5;var tr=_e(Ke,9,0),nr=_e(Ke,9,1),sr=_e(_t,5,0),or=_e(_t,5,1),Mn=function(o){for(var e=o[0],t=1;t<o.length;++t)o[t]>e&&(e=o[t]);return e},xe=function(o,e,t){var n=e/8|0;return(o[n]|o[n+1]<<8)>>(e&7)&t},Tn=function(o,e){var t=e/8|0;return(o[t]|o[t+1]<<8|o[t+2]<<16)>>(e&7)},rn=function(o){return(o/8|0)+(o&7&&1)},Ae=function(o,e,t){(e==null||e<0)&&(e=0),(t==null||t>o.length)&&(t=o.length);var n=new(o instanceof me?me:o instanceof Ve?Ve:U)(t-e);return n.set(o.subarray(e,t)),n},an=function(o,e,t){var n=o.length;if(!n||t&&!t.l&&n<5)return e||new U(0);var s=!e||t,r=!t||t.i;t||(t={}),e||(e=new U(n*3));var i=function(rt){var it=e.length;if(rt>it){var Ze=new U(Math.max(it*2,rt));Ze.set(e),e=Ze}},a=t.f||0,c=t.p||0,l=t.b||0,h=t.l,u=t.d,p=t.m,f=t.n,d=n*8;do{if(!h){t.f=a=xe(o,c,1);var m=xe(o,c+1,3);if(c+=3,m)if(m==1)h=nr,u=or,p=9,f=5;else if(m==2){var v=xe(o,c,31)+257,S=xe(o,c+10,15)+4,E=v+xe(o,c+5,31)+1;c+=14;for(var _=new U(E),T=new U(19),M=0;M<S;++M)T[en[M]]=xe(o,c+M*3,7);c+=S*3;for(var R=Mn(T),x=(1<<R)-1,O=_e(T,R,1),M=0;M<E;){var C=O[xe(o,c,x)];c+=C&15;var g=C>>>4;if(g<16)_[M++]=g;else{var I=0,P=0;for(g==16?(P=3+xe(o,c,3),c+=2,I=_[M-1]):g==17?(P=3+xe(o,c,7),c+=3):g==18&&(P=11+xe(o,c,127),c+=7);P--;)_[M++]=I}}var k=_.subarray(0,v),N=_.subarray(v);p=Mn(k),f=Mn(N),h=_e(k,p,1),u=_e(N,f,1)}else throw"invalid block type";else{var g=rn(c)+4,w=o[g-4]|o[g-3]<<8,y=g+w;if(y>n){if(r)throw"unexpected EOF";break}s&&i(l+w),e.set(o.subarray(g,y),l),t.b=l+=w,t.p=c=y*8;continue}if(c>d){if(r)throw"unexpected EOF";break}}s&&i(l+131072);for(var F=(1<<p)-1,H=(1<<f)-1,$=c;;$=c){var I=h[Tn(o,c)&F],oe=I>>>4;if(c+=I&15,c>d){if(r)throw"unexpected EOF";break}if(!I)throw"invalid length/literal";if(oe<256)e[l++]=oe;else if(oe==256){$=c,h=null;break}else{var X=oe-254;if(oe>264){var M=oe-257,se=Ct[M];X=xe(o,c,(1<<se)-1)+Es[M],c+=se}var we=u[Tn(o,c)&H],ae=we>>>4;if(!we)throw"invalid distance";c+=we&15;var N=er[ae];if(ae>3){var se=kt[ae];N+=Tn(o,c)&(1<<se)-1,c+=se}if(c>d){if(r)throw"unexpected EOF";break}s&&i(l+131072);for(var ue=l+X;l<ue;l+=4)e[l]=e[l-N],e[l+1]=e[l+1-N],e[l+2]=e[l+2-N],e[l+3]=e[l+3-N];l=ue}}t.l=h,t.p=$,t.b=l,h&&(a=1,t.m=p,t.d=u,t.n=f)}while(!a);return l==e.length?e:Ae(e,0,l)},Ce=function(o,e,t){t<<=e&7;var n=e/8|0;o[n]|=t,o[n+1]|=t>>>8},St=function(o,e,t){t<<=e&7;var n=e/8|0;o[n]|=t,o[n+1]|=t>>>8,o[n+2]|=t>>>16},xn=function(o,e){for(var t=[],n=0;n<o.length;++n)o[n]&&t.push({s:n,f:o[n]});var s=t.length,r=t.slice();if(!s)return[Xe,0];if(s==1){var i=new U(t[0].s+1);return i[t[0].s]=1,[i,1]}t.sort(function(E,_){return E.f-_.f}),t.push({s:-1,f:25001});var a=t[0],c=t[1],l=0,h=1,u=2;for(t[0]={s:-1,f:a.f+c.f,l:a,r:c};h!=s-1;)a=t[t[l].f<t[u].f?l++:u++],c=t[l!=h&&t[l].f<t[u].f?l++:u++],t[h++]={s:-1,f:a.f+c.f,l:a,r:c};for(var p=r[0].s,n=1;n<s;++n)r[n].s>p&&(p=r[n].s);var f=new me(p+1),d=In(t[h-1],f,0);if(d>e){var n=0,m=0,g=d-e,w=1<<g;for(r.sort(function(_,T){return f[T.s]-f[_.s]||_.f-T.f});n<s;++n){var y=r[n].s;if(f[y]>e)m+=w-(1<<d-f[y]),f[y]=e;else break}for(m>>>=g;m>0;){var v=r[n].s;f[v]<e?m-=1<<e-f[v]++-1:++n}for(;n>=0&&m;--n){var S=r[n].s;f[S]==e&&(--f[S],++m)}d=e}return[new U(f),d]},In=function(o,e,t){return o.s==-1?Math.max(In(o.l,e,t+1),In(o.r,e,t+1)):e[o.s]=t},as=function(o){for(var e=o.length;e&&!o[--e];);for(var t=new me(++e),n=0,s=o[0],r=1,i=function(c){t[n++]=c},a=1;a<=e;++a)if(o[a]==s&&a!=e)++r;else{if(!s&&r>2){for(;r>138;r-=138)i(32754);r>2&&(i(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(i(s),--r;r>6;r-=6)i(8304);r>2&&(i(r-3<<5|8208),r=0)}for(;r--;)i(s);r=1,s=o[a]}return[t.subarray(0,n),e]},Mt=function(o,e){for(var t=0,n=0;n<e.length;++n)t+=o[n]*e[n];return t},Yt=function(o,e,t){var n=t.length,s=rn(e+2);o[s]=n&255,o[s+1]=n>>>8,o[s+2]=o[s]^255,o[s+3]=o[s+1]^255;for(var r=0;r<n;++r)o[s+r+4]=t[r];return(s+4+n)*8},cs=function(o,e,t,n,s,r,i,a,c,l,h){Ce(e,h++,t),++s[256];for(var u=xn(s,15),p=u[0],f=u[1],d=xn(r,15),m=d[0],g=d[1],w=as(p),y=w[0],v=w[1],S=as(m),E=S[0],_=S[1],T=new me(19),M=0;M<y.length;++M)T[y[M]&31]++;for(var M=0;M<E.length;++M)T[E[M]&31]++;for(var R=xn(T,7),x=R[0],O=R[1],C=19;C>4&&!x[en[C-1]];--C);var I=l+5<<3,P=Mt(s,Ke)+Mt(r,_t)+i,k=Mt(s,p)+Mt(r,m)+i+14+3*C+Mt(T,x)+(2*T[16]+3*T[17]+7*T[18]);if(I<=P&&I<=k)return Yt(e,h,o.subarray(c,c+l));var N,F,H,$;if(Ce(e,h,1+(k<P)),h+=2,k<P){N=_e(p,f,0),F=p,H=_e(m,g,0),$=m;var oe=_e(x,O,0);Ce(e,h,v-257),Ce(e,h+5,_-1),Ce(e,h+10,C-4),h+=14;for(var M=0;M<C;++M)Ce(e,h+3*M,x[en[M]]);h+=3*C;for(var X=[y,E],se=0;se<2;++se)for(var we=X[se],M=0;M<we.length;++M){var ae=we[M]&31;Ce(e,h,oe[ae]),h+=x[ae],ae>15&&(Ce(e,h,we[M]>>>5&127),h+=we[M]>>>12)}}else N=tr,F=Ke,H=sr,$=_t;for(var M=0;M<a;++M)if(n[M]>255){var ae=n[M]>>>18&31;St(e,h,N[ae+257]),h+=F[ae+257],ae>7&&(Ce(e,h,n[M]>>>23&31),h+=Ct[ae]);var ue=n[M]&31;St(e,h,H[ue]),h+=$[ue],ue>3&&(St(e,h,n[M]>>>5&8191),h+=kt[ue])}else St(e,h,N[n[M]]),h+=F[n[M]];return St(e,h,N[256]),h+F[256]},rr=new Ve([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Xe=new U(0),ir=function(o,e,t,n,s,r){var i=o.length,a=new U(n+i+5*(1+Math.ceil(i/7e3))+s),c=a.subarray(n,a.length-s),l=0;if(!e||i<8)for(var h=0;h<=i;h+=65535){var u=h+65535;u<i?l=Yt(c,l,o.subarray(h,u)):(c[h]=r,l=Yt(c,l,o.subarray(h,i)))}else{for(var p=rr[e-1],f=p>>>13,d=p&8191,m=(1<<t)-1,g=new me(32768),w=new me(m+1),y=Math.ceil(t/3),v=2*y,S=function(gt){return(o[gt]^o[gt+1]<<y^o[gt+2]<<v)&m},E=new Ve(25e3),_=new me(288),T=new me(32),M=0,R=0,h=0,x=0,O=0,C=0;h<i;++h){var I=S(h),P=h&32767,k=w[I];if(g[P]=k,w[I]=P,O<=h){var N=i-h;if((M>7e3||x>24576)&&N>423){l=cs(o,c,0,E,_,T,R,x,C,h-C,l),x=M=R=0,C=h;for(var F=0;F<286;++F)_[F]=0;for(var F=0;F<30;++F)T[F]=0}var H=2,$=0,oe=d,X=P-k&32767;if(N>2&&I==S(h-X))for(var se=Math.min(f,N)-1,we=Math.min(32767,h),ae=Math.min(258,N);X<=we&&--oe&&P!=k;){if(o[h+H]==o[h+H-X]){for(var ue=0;ue<ae&&o[h+ue]==o[h+ue-X];++ue);if(ue>H){if(H=ue,$=X,ue>se)break;for(var rt=Math.min(X,ue-2),it=0,F=0;F<rt;++F){var Ze=h-X+F+32768&32767,hn=g[Ze],zt=Ze-hn+32768&32767;zt>it&&(it=zt,k=Ze)}}}P=k,k=g[P],X+=P-k+32768&32767}if($){E[x++]=268435456|An[H]<<18|is[$];var Ut=An[H]&31,pn=is[$]&31;R+=Ct[Ut]+kt[pn],++_[257+Ut],++T[pn],O=h+H,++M}else E[x++]=o[h],++_[o[h]]}}l=cs(o,c,r,E,_,T,R,x,C,h-C,l),!r&&l&7&&(l=Yt(c,l+1,Xe))}return Ae(a,0,n+rn(l)+s)},ar=function(){for(var o=new Ve(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&3988292384)^t>>>1;o[e]=t}return o}(),Dt=function(){var o=-1;return{p:function(e){for(var t=o,n=0;n<e.length;++n)t=ar[t&255^e[n]]^t>>>8;o=t},d:function(){return~o}}},Ss=function(){var o=1,e=0;return{p:function(t){for(var n=o,s=e,r=t.length,i=0;i!=r;){for(var a=Math.min(i+2655,r);i<a;++i)s+=n+=t[i];n=(n&65535)+15*(n>>16),s=(s&65535)+15*(s>>16)}o=n,e=s},d:function(){return o%=65521,e%=65521,(o&255)<<24|o>>>8<<16|(e&255)<<8|e>>>8}}},dt=function(o,e,t,n,s){return ir(o,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(o.length)))*1.5):12+e.mem,t,n,!s)},cn=function(o,e){var t={};for(var n in o)t[n]=o[n];for(var n in e)t[n]=e[n];return t},fo=function(o,e,t){for(var n=o(),s=o.toString(),r=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/ /g,"").split(","),i=0;i<n.length;++i){var a=n[i],c=r[i];if(typeof a=="function"){e+=";"+c+"=";var l=a.toString();if(a.prototype)if(l.indexOf("[native code]")!=-1){var h=l.indexOf(" ",8)+1;e+=l.slice(h,l.indexOf("(",h))}else{e+=l;for(var u in a.prototype)e+=";"+c+".prototype."+u+"="+a.prototype[u].toString()}else e+=l}else t[c]=a}return[e,t]},vn=[],Sa=function(o){var e=[];for(var t in o)(o[t]instanceof U||o[t]instanceof me||o[t]instanceof Ve)&&e.push((o[t]=new o[t].constructor(o[t])).buffer);return e},cr=function(o,e,t,n){var s;if(!vn[t]){for(var r="",i={},a=o.length-1,c=0;c<a;++c)s=fo(o[c],r,i),r=s[0],i=s[1];vn[t]=fo(o[a],r,i)}var l=cn({},vn[t][1]);return Ea(vn[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,l,Sa(l),n)},Nt=function(){return[U,me,Ve,Ct,kt,en,Es,er,nr,or,tn,_e,Mn,xe,Tn,rn,Ae,an,Bt,ot,Ms]},Ot=function(){return[U,me,Ve,Ct,kt,en,An,is,tr,Ke,sr,_t,tn,rr,Xe,_e,Ce,St,xn,In,as,Mt,Yt,cs,rn,Ae,ir,dt,ln,ot]},lr=function(){return[Ts,_s,q,Dt,ar]},ur=function(){return[xs,fr]},hr=function(){return[As,q,Ss]},pr=function(){return[dr]},ot=function(o){return postMessage(o,[o.buffer])},Ms=function(o){return o&&o.size&&new U(o.size)},Ft=function(o,e,t,n,s,r){var i=cr(t,n,s,function(a,c){i.terminate(),r(a,c)});return i.postMessage([o,e],e.consume?[o.buffer]:[]),function(){i.terminate()}},Ie=function(o){return o.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return o.push(e.data[0],e.data[1])}},jt=function(o,e,t,n,s){var r,i=cr(o,n,s,function(a,c){a?(i.terminate(),e.ondata.call(e,a)):(c[1]&&i.terminate(),e.ondata.call(e,a,c[0],c[1]))});i.postMessage(t),e.push=function(a,c){if(r)throw"stream finished";if(!e.ondata)throw"no stream handler";i.postMessage([a,r=c],[a.buffer])},e.terminate=function(){i.terminate()}},ve=function(o,e){return o[e]|o[e+1]<<8},ie=function(o,e){return(o[e]|o[e+1]<<8|o[e+2]<<16|o[e+3]<<24)>>>0},Xn=function(o,e){return ie(o,e)+ie(o,e+4)*4294967296},q=function(o,e,t){for(;t;++e)o[e]=t,t>>>=8},Ts=function(o,e){var t=e.filename;if(o[0]=31,o[1]=139,o[2]=8,o[8]=e.level<2?4:e.level==9?2:0,o[9]=3,e.mtime!=0&&q(o,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){o[3]=8;for(var n=0;n<=t.length;++n)o[n+10]=t.charCodeAt(n)}},xs=function(o){if(o[0]!=31||o[1]!=139||o[2]!=8)throw"invalid gzip data";var e=o[3],t=10;e&4&&(t+=o[10]|(o[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!o[t++]);return t+(e&2)},fr=function(o){var e=o.length;return(o[e-4]|o[e-3]<<8|o[e-2]<<16|o[e-1]<<24)>>>0},_s=function(o){return 10+(o.filename&&o.filename.length+1||0)},As=function(o,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;o[0]=120,o[1]=n<<6|(n?32-2*n:1)},dr=function(o){if((o[0]&15)!=8||o[0]>>>4>7||(o[0]<<8|o[1])%31)throw"invalid zlib data";if(o[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Is(o,e){return!e&&typeof o=="function"&&(e=o,o={}),this.ondata=e,o}var Fe=function(){function o(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return o.prototype.p=function(e,t){this.ondata(dt(e,this.o,0,0,!t),t)},o.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},o}(),mr=function(){function o(e,t){jt([Ot,function(){return[Ie,Fe]}],this,Is.call(this,e,t),function(n){var s=new Fe(n.data);onmessage=Ie(s)},6)}return o}();function gr(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ft(o,e,[Ot],function(n){return ot(ln(n.data[0],n.data[1]))},0,t)}function ln(o,e){return dt(o,e||{},0,0)}var Me=function(){function o(e){this.s={},this.p=new U(0),this.ondata=e}return o.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new U(t+e.length);n.set(this.p),n.set(e,t),this.p=n},o.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=an(this.p,this.o,this.s);this.ondata(Ae(n,t,this.s.b),this.d),this.o=Ae(n,this.s.b-32768),this.s.b=this.o.length,this.p=Ae(this.p,this.s.p/8|0),this.s.p&=7},o.prototype.push=function(e,t){this.e(e),this.c(t)},o}(),Ls=function(){function o(e){this.ondata=e,jt([Nt,function(){return[Ie,Me]}],this,0,function(){var t=new Me;onmessage=Ie(t)},7)}return o}();function Ps(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ft(o,e,[Nt],function(n){return ot(Bt(n.data[0],Ms(n.data[1])))},1,t)}function Bt(o,e){return an(o,e)}var Ln=function(){function o(e,t){this.c=Dt(),this.l=0,this.v=1,Fe.call(this,e,t)}return o.prototype.push=function(e,t){Fe.prototype.push.call(this,e,t)},o.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=dt(e,this.o,this.v&&_s(this.o),t&&8,!t);this.v&&(Ts(n,this.o),this.v=0),t&&(q(n,n.length-8,this.c.d()),q(n,n.length-4,this.l)),this.ondata(n,t)},o}(),mo=function(){function o(e,t){jt([Ot,lr,function(){return[Ie,Fe,Ln]}],this,Is.call(this,e,t),function(n){var s=new Ln(n.data);onmessage=Ie(s)},8)}return o}();function go(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ft(o,e,[Ot,lr,function(){return[Pn]}],function(n){return ot(Pn(n.data[0],n.data[1]))},2,t)}function Pn(o,e){e||(e={});var t=Dt(),n=o.length;t.p(o);var s=dt(o,e,_s(e),8),r=s.length;return Ts(s,e),q(s,r-8,t.d()),q(s,r-4,n),s}var Rn=function(){function o(e){this.v=1,Me.call(this,e)}return o.prototype.push=function(e,t){if(Me.prototype.e.call(this,e),this.v){var n=this.p.length>3?xs(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Me.prototype.c.call(this,t)},o}(),yr=function(){function o(e){this.ondata=e,jt([Nt,ur,function(){return[Ie,Me,Rn]}],this,0,function(){var t=new Rn;onmessage=Ie(t)},9)}return o}();function vr(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ft(o,e,[Nt,ur,function(){return[Cn]}],function(n){return ot(Cn(n.data[0]))},3,t)}function Cn(o,e){return an(o.subarray(xs(o),-8),e||new U(fr(o)))}var ls=function(){function o(e,t){this.c=Ss(),this.v=1,Fe.call(this,e,t)}return o.prototype.push=function(e,t){Fe.prototype.push.call(this,e,t)},o.prototype.p=function(e,t){this.c.p(e);var n=dt(e,this.o,this.v&&2,t&&4,!t);this.v&&(As(n,this.o),this.v=0),t&&q(n,n.length-4,this.c.d()),this.ondata(n,t)},o}(),Ma=function(){function o(e,t){jt([Ot,hr,function(){return[Ie,Fe,ls]}],this,Is.call(this,e,t),function(n){var s=new ls(n.data);onmessage=Ie(s)},10)}return o}();function Ta(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ft(o,e,[Ot,hr,function(){return[us]}],function(n){return ot(us(n.data[0],n.data[1]))},4,t)}function us(o,e){e||(e={});var t=Ss();t.p(o);var n=dt(o,e,2,4);return As(n,e),q(n,n.length-4,t.d()),n}var kn=function(){function o(e){this.v=1,Me.call(this,e)}return o.prototype.push=function(e,t){if(Me.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Me.prototype.c.call(this,t)},o}(),wr=function(){function o(e){this.ondata=e,jt([Nt,pr,function(){return[Ie,Me,kn]}],this,0,function(){var t=new kn;onmessage=Ie(t)},11)}return o}();function br(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ft(o,e,[Nt,pr,function(){return[nn]}],function(n){return ot(nn(n.data[0],Ms(n.data[1])))},5,t)}function nn(o,e){return an((dr(o),o.subarray(2,-4)),e)}var Er=function(){function o(e){this.G=Rn,this.I=Me,this.Z=kn,this.ondata=e}return o.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new U(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var s=this,r=function(){s.ondata.apply(s,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(r):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},o}(),xa=function(){function o(e){this.G=yr,this.I=Ls,this.Z=wr,this.ondata=e}return o.prototype.push=function(e,t){Er.prototype.push.call(this,e,t)},o}();function _a(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return o[0]==31&&o[1]==139&&o[2]==8?vr(o,e,t):(o[0]&15)!=8||o[0]>>4>7||(o[0]<<8|o[1])%31?Ps(o,e,t):br(o,e,t)}function Aa(o,e){return o[0]==31&&o[1]==139&&o[2]==8?Cn(o,e):(o[0]&15)!=8||o[0]>>4>7||(o[0]<<8|o[1])%31?Bt(o,e):nn(o,e)}var Rs=function(o,e,t,n){for(var s in o){var r=o[s],i=e+s;r instanceof U?t[i]=[r,n]:Array.isArray(r)?t[i]=[r[0],cn(n,r[1])]:Rs(r,i+"/",t,n)}},yo=typeof TextEncoder!="undefined"&&new TextEncoder,hs=typeof TextDecoder!="undefined"&&new TextDecoder,Sr=0;try{hs.decode(Xe,{stream:!0}),Sr=1}catch{}var Mr=function(o){for(var e="",t=0;;){var n=o[t++],s=(n>127)+(n>223)+(n>239);if(t+s>o.length)return[e,Ae(o,t-1)];s?s==3?(n=((n&15)<<18|(o[t++]&63)<<12|(o[t++]&63)<<6|o[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):s&1?e+=String.fromCharCode((n&31)<<6|o[t++]&63):e+=String.fromCharCode((n&15)<<12|(o[t++]&63)<<6|o[t++]&63):e+=String.fromCharCode(n)}},Ia=function(){function o(e){this.ondata=e,Sr?this.t=new TextDecoder:this.p=Xe}return o.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var n=new U(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var s=Mr(n),r=s[0],i=s[1];if(t){if(i.length)throw"invalid utf-8 data";this.p=null}else this.p=i;this.ondata(r,t)},o}(),La=function(){function o(e){this.ondata=e}return o.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(st(e),this.d=t||!1)},o}();function st(o,e){if(e){for(var t=new U(o.length),n=0;n<o.length;++n)t[n]=o.charCodeAt(n);return t}if(yo)return yo.encode(o);for(var s=o.length,r=new U(o.length+(o.length>>1)),i=0,a=function(h){r[i++]=h},n=0;n<s;++n){if(i+5>r.length){var c=new U(i+8+(s-n<<1));c.set(r),r=c}var l=o.charCodeAt(n);l<128||e?a(l):l<2048?(a(192|l>>6),a(128|l&63)):l>55295&&l<57344?(l=65536+(l&1023<<10)|o.charCodeAt(++n)&1023,a(240|l>>18),a(128|l>>12&63),a(128|l>>6&63),a(128|l&63)):(a(224|l>>12),a(128|l>>6&63),a(128|l&63))}return Ae(r,0,i)}function Cs(o,e){if(e){for(var t="",n=0;n<o.length;n+=16384)t+=String.fromCharCode.apply(null,o.subarray(n,n+16384));return t}else{if(hs)return hs.decode(o);var s=Mr(o),r=s[0],i=s[1];if(i.length)throw"invalid utf-8 data";return r}}var Tr=function(o){return o==1?3:o<6?2:o==9?1:0},xr=function(o,e){return e+30+ve(o,e+26)+ve(o,e+28)},_r=function(o,e,t){var n=ve(o,e+28),s=Cs(o.subarray(e+46,e+46+n),!(ve(o,e+8)&2048)),r=e+46+n,i=ie(o,e+20),a=t&&i==4294967295?Ar(o,r):[i,ie(o,e+24),ie(o,e+42)],c=a[0],l=a[1],h=a[2];return[ve(o,e+10),c,l,s,r+ve(o,e+30)+ve(o,e+32),h]},Ar=function(o,e){for(;ve(o,e)!=1;e+=4+ve(o,e+2));return[Xn(o,e+12),Xn(o,e+4),Xn(o,e+20)]},nt=function(o){var e=0;if(o)for(var t in o){var n=o[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},At=function(o,e,t,n,s,r,i,a){var c=n.length,l=t.extra,h=a&&a.length,u=nt(l);q(o,e,i!=null?33639248:67324752),e+=4,i!=null&&(o[e++]=20,o[e++]=t.os),o[e]=20,e+=2,o[e++]=t.flag<<1|(r==null&&8),o[e++]=s&&8,o[e++]=t.compression&255,o[e++]=t.compression>>8;var p=new Date(t.mtime==null?Date.now():t.mtime),f=p.getFullYear()-1980;if(f<0||f>119)throw"date not in range 1980-2099";if(q(o,e,f<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>>1),e+=4,r!=null&&(q(o,e,t.crc),q(o,e+4,r),q(o,e+8,t.size)),q(o,e+12,c),q(o,e+14,u),e+=16,i!=null&&(q(o,e,h),q(o,e+6,t.attrs),q(o,e+10,i),e+=14),o.set(n,e),e+=c,u)for(var d in l){var m=l[d],g=m.length;q(o,e,+d),q(o,e+2,g),o.set(m,e+4),e+=4+g}return h&&(o.set(a,e),e+=h),e},ks=function(o,e,t,n,s){q(o,e,101010256),q(o,e+8,t),q(o,e+10,t),q(o,e+12,n),q(o,e+16,s)},sn=function(){function o(e){this.filename=e,this.c=Dt(),this.size=0,this.compression=0}return o.prototype.process=function(e,t){this.ondata(null,e,t)},o.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},o}(),Pa=function(){function o(e,t){var n=this;t||(t={}),sn.call(this,e),this.d=new Fe(t,function(s,r){n.ondata(null,s,r)}),this.compression=8,this.flag=Tr(t.level)}return o.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},o.prototype.push=function(e,t){sn.prototype.push.call(this,e,t)},o}(),Ra=function(){function o(e,t){var n=this;t||(t={}),sn.call(this,e),this.d=new mr(t,function(s,r,i){n.ondata(s,r,i)}),this.compression=8,this.flag=Tr(t.level),this.terminate=this.d.terminate}return o.prototype.process=function(e,t){this.d.push(e,t)},o.prototype.push=function(e,t){sn.prototype.push.call(this,e,t)},o}(),Ca=function(){function o(e){this.ondata=e,this.u=[],this.d=1}return o.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var n=st(e.filename),s=n.length,r=e.comment,i=r&&st(r),a=s!=e.filename.length||i&&r.length!=i.length,c=s+nt(e.extra)+30;if(s>65535)throw"filename too long";var l=new U(c);At(l,0,e,n,a);var h=[l],u=function(){for(var g=0,w=h;g<w.length;g++){var y=w[g];t.ondata(null,y,!1)}h=[]},p=this.d;this.d=0;var f=this.u.length,d=cn(e,{f:n,u:a,o:i,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),p){var g=t.u[f+1];g?g.r():t.d=1}p=1}}),m=0;e.ondata=function(g,w,y){if(g)t.ondata(g,w,y),t.terminate();else if(m+=w.length,h.push(w),y){var v=new U(16);q(v,0,134695760),q(v,4,e.crc),q(v,8,m),q(v,12,e.size),h.push(v),d.c=m,d.b=c+m+16,d.crc=e.crc,d.size=e.size,p&&d.r(),p=1}else p&&u()},this.u.push(d)},o.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},o.prototype.e=function(){for(var e=0,t=0,n=0,s=0,r=this.u;s<r.length;s++){var i=r[s];n+=46+i.f.length+nt(i.extra)+(i.o?i.o.length:0)}for(var a=new U(n+22),c=0,l=this.u;c<l.length;c++){var i=l[c];At(a,e,i,i.f,i.u,i.c,t,i.o),e+=46+i.f.length+nt(i.extra)+(i.o?i.o.length:0),t+=i.b}ks(a,e,this.u.length,n,t),this.ondata(null,a,!0),this.d=2},o.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},o}();function ka(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};Rs(o,"",n,e);var s=Object.keys(n),r=s.length,i=0,a=0,c=r,l=new Array(r),h=[],u=function(){for(var m=0;m<h.length;++m)h[m]()},p=function(){var m=new U(a+22),g=i,w=a-i;a=0;for(var y=0;y<c;++y){var v=l[y];try{var S=v.c.length;At(m,a,v,v.f,v.u,S);var E=30+v.f.length+nt(v.extra),_=a+E;m.set(v.c,_),At(m,i,v,v.f,v.u,S,a,v.m),i+=16+E+(v.m?v.m.length:0),a=_+S}catch(T){return t(T,null)}}ks(m,i,l.length,w,g),t(null,m)};r||p();for(var f=function(m){var g=s[m],w=n[g],y=w[0],v=w[1],S=Dt(),E=y.length;S.p(y);var _=st(g),T=_.length,M=v.comment,R=M&&st(M),x=R&&R.length,O=nt(v.extra),C=v.level==0?0:8,I=function(P,k){if(P)u(),t(P,null);else{var N=k.length;l[m]=cn(v,{size:E,crc:S.d(),c:k,f:_,m:R,u:T!=g.length||R&&M.length!=x,compression:C}),i+=30+T+O+N,a+=76+2*(T+O)+(x||0)+N,--r||p()}};if(T>65535&&I("filename too long",null),!C)I(null,y);else if(E<16e4)try{I(null,ln(y,v))}catch(P){I(P,null)}else h.push(gr(y,v,I))},d=0;d<c;++d)f(d);return u}function Da(o,e){e||(e={});var t={},n=[];Rs(o,"",t,e);var s=0,r=0;for(var i in t){var a=t[i],c=a[0],l=a[1],h=l.level==0?0:8,u=st(i),p=u.length,f=l.comment,d=f&&st(f),m=d&&d.length,g=nt(l.extra);if(p>65535)throw"filename too long";var w=h?ln(c,l):c,y=w.length,v=Dt();v.p(c),n.push(cn(l,{size:c.length,crc:v.d(),c:w,f:u,m:d,u:p!=i.length||d&&f.length!=m,o:s,compression:h})),s+=30+p+g+y,r+=76+2*(p+g)+(m||0)+y}for(var S=new U(r+22),E=s,_=r-s,T=0;T<n.length;++T){var u=n[T];At(S,u.o,u,u.f,u.u,u.c.length);var M=30+u.f.length+nt(u.extra);S.set(u.c,u.o+M),At(S,s,u,u.f,u.u,u.c.length,u.o,u.m),s+=16+M+(u.m?u.m.length:0)}return ks(S,s,n.length,_,E),S}var Ir=function(){function o(){}return o.prototype.push=function(e,t){this.ondata(null,e,t)},o.compression=0,o}(),Na=function(){function o(){var e=this;this.i=new Me(function(t,n){e.ondata(null,t,n)})}return o.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},o.compression=8,o}(),Oa=function(){function o(e,t){var n=this;t<32e4?this.i=new Me(function(s,r){n.ondata(null,s,r)}):(this.i=new Ls(function(s,r,i){n.ondata(s,r,i)}),this.terminate=this.i.terminate)}return o.prototype.push=function(e,t){this.i.terminate&&(e=Ae(e,0)),this.i.push(e,t)},o.compression=8,o}(),Fa=function(){function o(e){this.onfile=e,this.k=[],this.o={0:Ir},this.p=Xe}return o.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var s=Math.min(this.c,e.length),r=e.subarray(0,s);if(this.c-=s,this.d?this.d.push(r,!this.c):this.k[0].push(r),e=e.subarray(s),e.length)return this.push(e,t)}else{var i=0,a=0,c=void 0,l=void 0;this.p.length?e.length?(l=new U(this.p.length+e.length),l.set(this.p),l.set(e,this.p.length)):l=this.p:l=e;for(var h=l.length,u=this.c,p=u&&this.d,f=function(){var w,y=ie(l,a);if(y==67324752){i=1,c=a,d.d=null,d.c=0;var v=ve(l,a+6),S=ve(l,a+8),E=v&2048,_=v&8,T=ve(l,a+26),M=ve(l,a+28);if(h>a+30+T+M){var R=[];d.k.unshift(R),i=2;var x=ie(l,a+18),O=ie(l,a+22),C=Cs(l.subarray(a+30,a+=30+T),!E);x==4294967295?(w=_?[-2]:Ar(l,a),x=w[0],O=w[1]):_&&(x=-1),a+=M,d.c=x;var I,P={name:C,compression:S,start:function(){if(!P.ondata)throw"no callback";if(!x)P.ondata(null,Xe,!0);else{var k=n.o[S];if(!k)throw"unknown compression type "+S;I=x<0?new k(C):new k(C,x,O),I.ondata=function($,oe,X){P.ondata($,oe,X)};for(var N=0,F=R;N<F.length;N++){var H=F[N];I.push(H,!1)}n.k[0]==R&&n.c?n.d=I:I.push(Xe,!0)}},terminate:function(){I&&I.terminate&&I.terminate()}};x>=0&&(P.size=x,P.originalSize=O),d.onfile(P)}return"break"}else if(u){if(y==134695760)return c=a+=12+(u==-2&&8),i=3,d.c=0,"break";if(y==33639248)return c=a-=4,i=3,d.c=0,"break"}},d=this;a<h-4;++a){var m=f();if(m==="break")break}if(this.p=Xe,u<0){var g=i?l.subarray(0,c-12-(u==-2&&8)-(ie(l,c-16)==134695760&&4)):l.subarray(0,a);p?p.push(g,!!i):this.k[+(i==2)].push(g)}if(i&2)return this.push(l.subarray(a),t);this.p=l.subarray(a)}if(t){if(this.c)throw"invalid zip file";this.p=null}},o.prototype.register=function(e){this.o[e.compression]=e},o}();function ja(o,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var p=0;p<t.length;++p)t[p]()},s={},r=o.length-22;ie(o,r)!=101010256;--r)if(!r||o.length-r>65558){e("invalid zip file",null);return}var i=ve(o,r+8);i||e(null,{});var a=i,c=ie(o,r+16),l=c==4294967295;if(l){if(r=ie(o,r-12),ie(o,r)!=101075792){e("invalid zip file",null);return}a=i=ie(o,r+32),c=ie(o,r+48)}for(var h=function(p){var f=_r(o,c,l),d=f[0],m=f[1],g=f[2],w=f[3],y=f[4],v=f[5],S=xr(o,v);c=y;var E=function(T,M){T?(n(),e(T,null)):(s[w]=M,--i||e(null,s))};if(!d)E(null,Ae(o,S,S+m));else if(d==8){var _=o.subarray(S,S+m);if(m<32e4)try{E(null,Bt(_,new U(g)))}catch(T){E(T,null)}else t.push(Ps(_,{size:g},E))}else E("unknown compression type "+d,null)},u=0;u<a;++u)h();return n}function Ba(o){for(var e={},t=o.length-22;ie(o,t)!=101010256;--t)if(!t||o.length-t>65558)throw"invalid zip file";var n=ve(o,t+8);if(!n)return{};var s=ie(o,t+16),r=s==4294967295;if(r){if(t=ie(o,t-12),ie(o,t)!=101075792)throw"invalid zip file";n=ie(o,t+32),s=ie(o,t+48)}for(var i=0;i<n;++i){var a=_r(o,s,r),c=a[0],l=a[1],h=a[2],u=a[3],p=a[4],f=a[5],d=xr(o,f);if(s=p,!c)e[u]=Ae(o,d,d+l);else if(c==8)e[u]=Bt(o.subarray(d,d+l),new U(h));else throw"unknown compression type "+c}return e}var za=Object.freeze(Object.defineProperty({__proto__:null,AsyncCompress:mo,AsyncDecompress:xa,AsyncDeflate:mr,AsyncGunzip:yr,AsyncGzip:mo,AsyncInflate:Ls,AsyncUnzipInflate:Oa,AsyncUnzlib:wr,AsyncZipDeflate:Ra,AsyncZlib:Ma,Compress:Ln,DecodeUTF8:Ia,Decompress:Er,Deflate:Fe,EncodeUTF8:La,Gunzip:Rn,Gzip:Ln,Inflate:Me,Unzip:Fa,UnzipInflate:Na,UnzipPassThrough:Ir,Unzlib:kn,Zip:Ca,ZipDeflate:Pa,ZipPassThrough:sn,Zlib:ls,compress:go,compressSync:Pn,decompress:_a,decompressSync:Aa,deflate:gr,deflateSync:ln,gunzip:vr,gunzipSync:Cn,gzip:go,gzipSync:Pn,inflate:Ps,inflateSync:Bt,strFromU8:Cs,strToU8:st,unzip:ja,unzipSync:Ba,unzlib:br,unzlibSync:nn,zip:ka,zipSync:Da,zlib:Ta,zlibSync:us},Symbol.toStringTag,{value:"Module"}));function Lr(o,e,t){const n=t.length-o-1;if(e>=t[n])return n-1;if(e<=t[o])return o;let s=o,r=n,i=Math.floor((s+r)/2);for(;e<t[i]||e>=t[i+1];)e<t[i]?r=i:s=i,i=Math.floor((s+r)/2);return i}function Ua(o,e,t,n){const s=[],r=[],i=[];s[0]=1;for(let a=1;a<=t;++a){r[a]=e-n[o+1-a],i[a]=n[o+a]-e;let c=0;for(let l=0;l<a;++l){const h=i[l+1],u=r[a-l],p=s[l]/(h+u);s[l]=c+h*p,c=u*p}s[a]=c}return s}function Ga(o,e,t,n){const s=Lr(o,n,e),r=Ua(s,n,o,e),i=new Nn(0,0,0,0);for(let a=0;a<=o;++a){const c=t[s-o+a],l=r[a],h=c.w*l;i.x+=c.x*h,i.y+=c.y*h,i.z+=c.z*h,i.w+=c.w*l}return i}function Ha(o,e,t,n,s){const r=[];for(let u=0;u<=t;++u)r[u]=0;const i=[];for(let u=0;u<=n;++u)i[u]=r.slice(0);const a=[];for(let u=0;u<=t;++u)a[u]=r.slice(0);a[0][0]=1;const c=r.slice(0),l=r.slice(0);for(let u=1;u<=t;++u){c[u]=e-s[o+1-u],l[u]=s[o+u]-e;let p=0;for(let f=0;f<u;++f){const d=l[f+1],m=c[u-f];a[u][f]=d+m;const g=a[f][u-1]/a[u][f];a[f][u]=p+d*g,p=m*g}a[u][u]=p}for(let u=0;u<=t;++u)i[0][u]=a[u][t];for(let u=0;u<=t;++u){let p=0,f=1;const d=[];for(let m=0;m<=t;++m)d[m]=r.slice(0);d[0][0]=1;for(let m=1;m<=n;++m){let g=0;const w=u-m,y=t-m;u>=m&&(d[f][0]=d[p][0]/a[y+1][w],g=d[f][0]*a[w][y]);const v=w>=-1?1:-w,S=u-1<=y?m-1:t-u;for(let _=v;_<=S;++_)d[f][_]=(d[p][_]-d[p][_-1])/a[y+1][w+_],g+=d[f][_]*a[w+_][y];u<=y&&(d[f][m]=-d[p][m-1]/a[y+1][u],g+=d[f][m]*a[u][y]),i[m][u]=g;const E=p;p=f,f=E}}let h=t;for(let u=1;u<=n;++u){for(let p=0;p<=t;++p)i[u][p]*=h;h*=t-u}return i}function $a(o,e,t,n,s){const r=s<o?s:o,i=[],a=Lr(o,n,e),c=Ha(a,n,o,r,e),l=[];for(let h=0;h<t.length;++h){const u=t[h].clone(),p=u.w;u.x*=p,u.y*=p,u.z*=p,l[h]=u}for(let h=0;h<=r;++h){const u=l[a-o].clone().multiplyScalar(c[h][0]);for(let p=1;p<=o;++p)u.add(l[a-o+p].clone().multiplyScalar(c[h][p]));i[h]=u}for(let h=r+1;h<=s+1;++h)i[h]=new Nn(0,0,0);return i}function Xa(o,e){let t=1;for(let s=2;s<=o;++s)t*=s;let n=1;for(let s=2;s<=e;++s)n*=s;for(let s=2;s<=o-e;++s)n*=s;return t/n}function qa(o){const e=o.length,t=[],n=[];for(let r=0;r<e;++r){const i=o[r];t[r]=new A(i.x,i.y,i.z),n[r]=i.w}const s=[];for(let r=0;r<e;++r){const i=t[r].clone();for(let a=1;a<=r;++a)i.sub(s[r-a].clone().multiplyScalar(Xa(r,a)*n[a]));s[r]=i.divideScalar(n[0])}return s}function Va(o,e,t,n,s){const r=$a(o,e,t,n,s);return qa(r)}class vo extends Mi{constructor(e,t,n,s,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=r||this.knots.length-1;for(let i=0;i<n.length;++i){const a=n[i];this.controlPoints[i]=new Nn(a.x,a.y,a.z,a.w)}}getPoint(e,t=new A){const n=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=Ga(this.degree,this.knots,this.controlPoints,s);return r.w!==1&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new A){const n=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=Va(this.degree,this.knots,this.controlPoints,s,1);return n.copy(r[1]).normalize(),n}}let z,re,Ee;class Ka extends Lo{constructor(e){super(e)}load(e,t,n,s){const r=this,i=r.path===""?Ne.extractUrlBase(e):r.path,a=new ds(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(c){try{t(r.parse(c,i))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},n,s)}parse(e,t){if(ec(e))z=new Ja().parse(e);else{const s=kr(e);if(!tc(s))throw new Error("THREE.FBXLoader: Unknown format.");if(bo(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+bo(s));z=new Qa().parse(s)}const n=new vs(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Ya(n,this.manager).parse(z)}}class Ya{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){re=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),s=this.parseDeformers(),r=new Za().parse(s);return this.parseScene(s,r,n),Ee}parseConnections(){const e=new Map;return"Connections"in z&&z.Connections.connections.forEach(function(n){const s=n[0],r=n[1],i=n[2];e.has(s)||e.set(s,{parents:[],children:[]});const a={ID:r,relationship:i};e.get(s).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const c={ID:s,relationship:i};e.get(r).children.push(c)}),e}parseImages(){const e={},t={};if("Video"in z.Objects){const n=z.Objects.Video;for(const s in n){const r=n[s],i=parseInt(s);if(e[i]=r.RelativeFilename||r.Filename,"Content"in r){const a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,c=typeof r.Content=="string"&&r.Content!=="";if(a||c){const l=this.parseImage(n[s]);t[r.RelativeFilename||r.Filename]=l}}}}for(const n in e){const s=e[n];t[s]!==void 0?e[n]=t[s]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,s=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(s){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{const i=new Uint8Array(t);return window.URL.createObjectURL(new Blob([i],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in z.Objects){const n=z.Objects.Texture;for(const s in n){const r=this.parseTexture(n[s],e);t.set(parseInt(s),r)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const s=e.WrapModeU,r=e.WrapModeV,i=s!==void 0?s.value:0,a=r!==void 0?r.value:0;if(n.wrapS=i===0?Zt:Wn,n.wrapT=a===0?Zt:Wn,"Scaling"in e){const c=e.Scaling.value;n.repeat.x=c[0],n.repeat.y=c[1]}return n}loadTexture(e,t){let n;const s=this.textureLoader.path,r=re.get(e.id).children;r!==void 0&&r.length>0&&t[r[0].ID]!==void 0&&(n=t[r[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let i;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),i=new Qt):(c.setPath(this.textureLoader.path),i=c.load(n))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),i=new Qt):i=this.textureLoader.load(n);return this.textureLoader.setPath(s),i}parseMaterials(e){const t=new Map;if("Material"in z.Objects){const n=z.Objects.Material;for(const s in n){const r=this.parseMaterial(n[s],e);r!==null&&t.set(parseInt(s),r)}}return t}parseMaterial(e,t){const n=e.id,s=e.attrName;let r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!re.has(n))return null;const i=this.parseParameters(e,t,n);let a;switch(r.toLowerCase()){case"phong":a=new En;break;case"lambert":a=new zo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new En;break}return a.setValues(i),a.name=s,a}parseParameters(e,t,n){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new ne().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=new ne().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new ne().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=new ne().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new ne().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new ne().fromArray(e.SpecularColor.value));const r=this;return re.get(n).children.forEach(function(i){const a=i.relationship;switch(a){case"Bump":s.bumpMap=r.getTexture(t,i.ID);break;case"Maya|TEX_ao_map":s.aoMap=r.getTexture(t,i.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=r.getTexture(t,i.ID),s.map!==void 0&&(s.map.encoding=De);break;case"DisplacementColor":s.displacementMap=r.getTexture(t,i.ID);break;case"EmissiveColor":s.emissiveMap=r.getTexture(t,i.ID),s.emissiveMap!==void 0&&(s.emissiveMap.encoding=De);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=r.getTexture(t,i.ID);break;case"ReflectionColor":s.envMap=r.getTexture(t,i.ID),s.envMap!==void 0&&(s.envMap.mapping=Ti,s.envMap.encoding=De);break;case"SpecularColor":s.specularMap=r.getTexture(t,i.ID),s.specularMap!==void 0&&(s.specularMap.encoding=De);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=r.getTexture(t,i.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),s}getTexture(e,t){return"LayeredTexture"in z.Objects&&t in z.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=re.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in z.Objects){const n=z.Objects.Deformer;for(const s in n){const r=n[s],i=re.get(parseInt(s));if(r.attrType==="Skin"){const a=this.parseSkeleton(i,n);a.ID=s,i.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=i.parents[0].ID,e[s]=a}else if(r.attrType==="BlendShape"){const a={id:s};a.rawTargets=this.parseMorphTargets(i,n),a.id=s,i.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[s]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(s){const r=t[s.ID];if(r.attrType!=="Cluster")return;const i={ID:s.ID,indices:[],weights:[],transformLink:new Q().fromArray(r.TransformLink.a)};"Indexes"in r&&(i.indices=r.Indexes.a,i.weights=r.Weights.a),n.push(i)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let s=0;s<e.children.length;s++){const r=e.children[s],i=t[r.ID],a={name:i.attrName,initialWeight:i.DeformPercent,id:i.id,fullWeights:i.FullWeights.a};if(i.attrType!=="BlendShapeChannel")return;a.geoID=re.get(parseInt(r.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,n.push(a)}return n}parseScene(e,t,n){Ee=new Tt;const s=this.parseModels(e.skeletons,t,n),r=z.Objects.Model,i=this;s.forEach(function(c){const l=r[c.ID];i.setLookAtProperties(c,l),re.get(c.ID).parents.forEach(function(u){const p=s.get(u.ID);p!==void 0&&p.add(c)}),c.parent===null&&Ee.add(c)}),this.bindSkeleton(e.skeletons,t,s),this.createAmbientLight(),Ee.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const l=Rr(c.userData.transformData);c.applyMatrix4(l),c.updateWorldMatrix()}});const a=new Wa().parse();Ee.children.length===1&&Ee.children[0].isGroup&&(Ee.children[0].animations=a,Ee=Ee.children[0]),Ee.animations=a}parseModels(e,t,n){const s=new Map,r=z.Objects.Model;for(const i in r){const a=parseInt(i),c=r[i],l=re.get(a);let h=this.buildSkeleton(l,e,a,c.attrName);if(!h){switch(c.attrType){case"Camera":h=this.createCamera(l);break;case"Light":h=this.createLight(l);break;case"Mesh":h=this.createMesh(l,t,n);break;case"NurbsCurve":h=this.createCurve(l,t);break;case"LimbNode":case"Root":h=new Jn;break;case"Null":default:h=new Tt;break}h.name=c.attrName?Wt.sanitizeNodeName(c.attrName):"",h.ID=a}this.getTransformData(h,c),s.set(a,h)}return s}buildSkeleton(e,t,n,s){let r=null;return e.parents.forEach(function(i){for(const a in t){const c=t[a];c.rawBones.forEach(function(l,h){if(l.ID===i.ID){const u=r;r=new Jn,r.matrixWorld.copy(l.transformLink),r.name=s?Wt.sanitizeNodeName(s):"",r.ID=n,c.bones[h]=r,u!==null&&r.add(u)}})}}),r}createCamera(e){let t,n;if(e.children.forEach(function(s){const r=z.Objects.NodeAttribute[s.ID];r!==void 0&&(n=r)}),n===void 0)t=new qe;else{let s=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(s=1);let r=1;n.NearPlane!==void 0&&(r=n.NearPlane.value/1e3);let i=1e3;n.FarPlane!==void 0&&(i=n.FarPlane.value/1e3);let a=window.innerWidth,c=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(a=n.AspectWidth.value,c=n.AspectHeight.value);const l=a/c;let h=45;n.FieldOfView!==void 0&&(h=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(s){case 0:t=new ws(h,l,r,i),u!==null&&t.setFocalLength(u);break;case 1:t=new No(-a/2,a/2,c/2,-c/2,r,i);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),t=new qe;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(s){const r=z.Objects.NodeAttribute[s.ID];r!==void 0&&(n=r)}),n===void 0)t=new qe;else{let s;n.LightType===void 0?s=0:s=n.LightType.value;let r=16777215;n.Color!==void 0&&(r=new ne().fromArray(n.Color.value));let i=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(i=0);let a=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?a=0:a=n.FarAttenuationEnd.value);const c=1;switch(s){case 0:t=new _n(r,i,a,c);break;case 1:t=new gs(r,i);break;case 2:let l=Math.PI/3;n.InnerAngle!==void 0&&(l=Pe.degToRad(n.InnerAngle.value));let h=0;n.OuterAngle!==void 0&&(h=Pe.degToRad(n.OuterAngle.value),h=Math.max(h,1)),t=new ms(r,i,a,l,h,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new _n(r,i);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let s,r=null,i=null;const a=[];return e.children.forEach(function(c){t.has(c.ID)&&(r=t.get(c.ID)),n.has(c.ID)&&a.push(n.get(c.ID))}),a.length>1?i=a:a.length>0?i=a[0]:(i=new En({color:13421772}),a.push(i)),"color"in r.attributes&&a.forEach(function(c){c.vertexColors=!0}),r.FBX_Deformer?(s=new ko(r,i),s.normalizeSkinWeights()):s=new L(r,i),s}createCurve(e,t){const n=e.children.reduce(function(r,i){return t.has(i.ID)&&(r=t.get(i.ID)),r},null),s=new fs({color:3342591,linewidth:1});return new ke(n,s)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=Cr(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&re.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const r=z.Objects.Model[s.ID];if("Lcl_Translation"in r){const i=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(i),Ee.add(e.target)):e.lookAt(new A().fromArray(i))}}})}bindSkeleton(e,t,n){const s=this.parsePoseNodes();for(const r in e){const i=e[r];re.get(parseInt(i.ID)).parents.forEach(function(c){if(t.has(c.ID)){const l=c.ID;re.get(l).parents.forEach(function(u){n.has(u.ID)&&n.get(u.ID).bind(new Bo(i.bones),s[u.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in z.Objects){const t=z.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const s=t[n].PoseNode;Array.isArray(s)?s.forEach(function(r){e[r.Node]=new Q().fromArray(r.Matrix.a)}):e[s.Node]=new Q().fromArray(s.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in z&&"AmbientColor"in z.GlobalSettings){const e=z.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],s=e[2];if(t!==0||n!==0||s!==0){const r=new ne(t,n,s);Ee.add(new xi(r,1))}}}}class Za{parse(e){const t=new Map;if("Geometry"in z.Objects){const n=z.Objects.Geometry;for(const s in n){const r=re.get(parseInt(s)),i=this.parseGeometry(r,n[s],e);t.set(parseInt(s),i)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const s=n.skeletons,r=[],i=e.parents.map(function(u){return z.Objects.Model[u.ID]});if(i.length===0)return;const a=e.children.reduce(function(u,p){return s[p.ID]!==void 0&&(u=s[p.ID]),u},null);e.children.forEach(function(u){n.morphTargets[u.ID]!==void 0&&r.push(n.morphTargets[u.ID])});const c=i[0],l={};"RotationOrder"in c&&(l.eulerOrder=Cr(c.RotationOrder.value)),"InheritType"in c&&(l.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(l.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(l.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(l.scale=c.GeometricScaling.value);const h=Rr(l);return this.genGeometry(t,a,r,h)}genGeometry(e,t,n,s){const r=new $e;e.attrName&&(r.name=e.attrName);const i=this.parseGeoNode(e,t),a=this.genBuffers(i),c=new tt(a.vertex,3);if(c.applyMatrix4(s),r.setAttribute("position",c),a.colors.length>0&&r.setAttribute("color",new tt(a.colors,3)),t&&(r.setAttribute("skinIndex",new _i(a.weightsIndices,4)),r.setAttribute("skinWeight",new tt(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const l=new Ai().getNormalMatrix(s),h=new tt(a.normal,3);h.applyNormalMatrix(l),r.setAttribute("normal",h)}if(a.uvs.forEach(function(l,h){let u="uv"+(h+1).toString();h===0&&(u="uv"),r.setAttribute(u,new tt(a.uvs[h],2))}),i.material&&i.material.mappingType!=="AllSame"){let l=a.materialIndex[0],h=0;if(a.materialIndex.forEach(function(u,p){u!==l&&(r.addGroup(h,p-h,l),l=u,h=p)}),r.groups.length>0){const u=r.groups[r.groups.length-1],p=u.start+u.count;p!==a.materialIndex.length&&r.addGroup(p,a.materialIndex.length-p,l)}r.groups.length===0&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,n,s),r}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(s,r){s.indices.forEach(function(i,a){n.weightTable[i]===void 0&&(n.weightTable[i]=[]),n.weightTable[i].push({id:r,weight:s.weights[a]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,s=0,r=!1,i=[],a=[],c=[],l=[],h=[],u=[];const p=this;return e.vertexIndices.forEach(function(f,d){let m,g=!1;f<0&&(f=f^-1,g=!0);let w=[],y=[];if(i.push(f*3,f*3+1,f*3+2),e.color){const v=wn(d,n,f,e.color);c.push(v[0],v[1],v[2])}if(e.skeleton){if(e.weightTable[f]!==void 0&&e.weightTable[f].forEach(function(v){y.push(v.weight),w.push(v.id)}),y.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const v=[0,0,0,0],S=[0,0,0,0];y.forEach(function(E,_){let T=E,M=w[_];S.forEach(function(R,x,O){if(T>R){O[x]=T,T=R;const C=v[x];v[x]=M,M=C}})}),w=v,y=S}for(;y.length<4;)y.push(0),w.push(0);for(let v=0;v<4;++v)h.push(y[v]),u.push(w[v])}if(e.normal){const v=wn(d,n,f,e.normal);a.push(v[0],v[1],v[2])}e.material&&e.material.mappingType!=="AllSame"&&(m=wn(d,n,f,e.material)[0]),e.uv&&e.uv.forEach(function(v,S){const E=wn(d,n,f,v);l[S]===void 0&&(l[S]=[]),l[S].push(E[0]),l[S].push(E[1])}),s++,g&&(p.genFace(t,e,i,m,a,c,l,h,u,s),n++,s=0,i=[],a=[],c=[],l=[],h=[],u=[])}),t}genFace(e,t,n,s,r,i,a,c,l,h){for(let u=2;u<h;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(u-1)*3]]),e.vertex.push(t.vertexPositions[n[(u-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(u-1)*3+2]]),e.vertex.push(t.vertexPositions[n[u*3]]),e.vertex.push(t.vertexPositions[n[u*3+1]]),e.vertex.push(t.vertexPositions[n[u*3+2]]),t.skeleton&&(e.vertexWeights.push(c[0]),e.vertexWeights.push(c[1]),e.vertexWeights.push(c[2]),e.vertexWeights.push(c[3]),e.vertexWeights.push(c[(u-1)*4]),e.vertexWeights.push(c[(u-1)*4+1]),e.vertexWeights.push(c[(u-1)*4+2]),e.vertexWeights.push(c[(u-1)*4+3]),e.vertexWeights.push(c[u*4]),e.vertexWeights.push(c[u*4+1]),e.vertexWeights.push(c[u*4+2]),e.vertexWeights.push(c[u*4+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[(u-1)*4]),e.weightsIndices.push(l[(u-1)*4+1]),e.weightsIndices.push(l[(u-1)*4+2]),e.weightsIndices.push(l[(u-1)*4+3]),e.weightsIndices.push(l[u*4]),e.weightsIndices.push(l[u*4+1]),e.weightsIndices.push(l[u*4+2]),e.weightsIndices.push(l[u*4+3])),t.color&&(e.colors.push(i[0]),e.colors.push(i[1]),e.colors.push(i[2]),e.colors.push(i[(u-1)*3]),e.colors.push(i[(u-1)*3+1]),e.colors.push(i[(u-1)*3+2]),e.colors.push(i[u*3]),e.colors.push(i[u*3+1]),e.colors.push(i[u*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[(u-1)*3]),e.normal.push(r[(u-1)*3+1]),e.normal.push(r[(u-1)*3+2]),e.normal.push(r[u*3]),e.normal.push(r[u*3+1]),e.normal.push(r[u*3+2])),t.uv&&t.uv.forEach(function(p,f){e.uvs[f]===void 0&&(e.uvs[f]=[]),e.uvs[f].push(a[f][0]),e.uvs[f].push(a[f][1]),e.uvs[f].push(a[f][(u-1)*2]),e.uvs[f].push(a[f][(u-1)*2+1]),e.uvs[f].push(a[f][u*2]),e.uvs[f].push(a[f][u*2+1])})}addMorphTargets(e,t,n,s){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach(function(i){i.rawTargets.forEach(function(a){const c=z.Objects.Geometry[a.geoID];c!==void 0&&r.genMorphGeometry(e,t,c,s,a.name)})})}genMorphGeometry(e,t,n,s,r){const i=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=n.Vertices!==void 0?n.Vertices.a:[],c=n.Indexes!==void 0?n.Indexes.a:[],l=e.attributes.position.count*3,h=new Float32Array(l);for(let d=0;d<c.length;d++){const m=c[d]*3;h[m]=a[d*3],h[m+1]=a[d*3+1],h[m+2]=a[d*3+2]}const u={vertexIndices:i,vertexPositions:h},p=this.genBuffers(u),f=new tt(p.vertex,3);f.name=r||n.attrName,f.applyMatrix4(s),e.morphAttributes.position.push(f)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Normals.a;let r=[];return n==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.UV.a;let r=[];return n==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:s,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Colors.a;let r=[];return n==="IndexToDirect"&&(r=e.ColorIndex.a),{dataSize:4,buffer:s,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const s=e.Materials.a,r=[];for(let i=0;i<s.length;++i)r.push(i);return{dataSize:1,buffer:s,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(vo===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new $e;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new $e;const n=t-1,s=e.KnotVector.a,r=[],i=e.Points.a;for(let u=0,p=i.length;u<p;u+=4)r.push(new Nn().fromArray(i,u));let a,c;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){a=n,c=s.length-1-a;for(let u=0;u<n;++u)r.push(r[u])}const h=new vo(n,s,r,a,c).getPoints(r.length*12);return new $e().setFromPoints(h)}}class Wa{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const s=t[n],r=this.addClip(s);e.push(r)}return e}parseClips(){if(z.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=z.Objects.AnimationCurveNode,t=new Map;for(const n in e){const s=e[n];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:s.id,attr:s.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){const t=z.Objects.AnimationCurve;for(const n in t){const s={id:t[n].id,times:t[n].KeyTime.a.map(nc),values:t[n].KeyValueFloat.a},r=re.get(s.id);if(r!==void 0){const i=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?e.get(i).curves.x=s:a.match(/Y/)?e.get(i).curves.y=s:a.match(/Z/)?e.get(i).curves.z=s:a.match(/d|DeformPercent/)&&e.has(i)&&(e.get(i).curves.morph=s)}}}parseAnimationLayers(e){const t=z.Objects.AnimationLayer,n=new Map;for(const s in t){const r=[],i=re.get(parseInt(s));i!==void 0&&(i.children.forEach(function(c,l){if(e.has(c.ID)){const h=e.get(c.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(r[l]===void 0){const u=re.get(c.ID).parents.filter(function(p){return p.relationship!==void 0})[0].ID;if(u!==void 0){const p=z.Objects.Model[u.toString()];if(p===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const f={modelName:p.attrName?Wt.sanitizeNodeName(p.attrName):"",ID:p.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ee.traverse(function(d){d.ID===p.id&&(f.transform=d.matrix,d.userData.transformData&&(f.eulerOrder=d.userData.transformData.eulerOrder))}),f.transform||(f.transform=new Q),"PreRotation"in p&&(f.preRotation=p.PreRotation.value),"PostRotation"in p&&(f.postRotation=p.PostRotation.value),r[l]=f}}r[l]&&(r[l][h.attr]=h)}else if(h.curves.morph!==void 0){if(r[l]===void 0){const u=re.get(c.ID).parents.filter(function(w){return w.relationship!==void 0})[0].ID,p=re.get(u).parents[0].ID,f=re.get(p).parents[0].ID,d=re.get(f).parents[0].ID,m=z.Objects.Model[d],g={modelName:m.attrName?Wt.sanitizeNodeName(m.attrName):"",morphName:z.Objects.Deformer[u].attrName};r[l]=g}r[l][h.attr]=h}}}),n.set(parseInt(s),r))}return n}parseAnimStacks(e){const t=z.Objects.AnimationStack,n={};for(const s in t){const r=re.get(parseInt(s)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const i=e.get(r[0].ID);n[s]={name:t[s].attrName,layer:i}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(s){t=t.concat(n.generateTracks(s))}),new jo(e.name,-1,t)}generateTracks(e){const t=[];let n=new A,s=new de,r=new A;if(e.transform&&e.transform.decompose(n,s,r),n=n.toArray(),s=new ht().setFromQuaternion(s,e.eulerOrder).toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");i!==void 0&&t.push(i)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const i=this.generateRotationTrack(e.modelName,e.R.curves,s,e.preRotation,e.postRotation,e.eulerOrder);i!==void 0&&t.push(i)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");i!==void 0&&t.push(i)}if(e.DeformPercent!==void 0){const i=this.generateMorphTrack(e);i!==void 0&&t.push(i)}return t}generateVectorTrack(e,t,n,s){const r=this.getTimesForAllAxes(t),i=this.getKeyframeTrackValues(r,t,n);return new Oo(e+"."+s,r,i)}generateRotationTrack(e,t,n,s,r,i){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(Pe.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(Pe.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(Pe.degToRad));const a=this.getTimesForAllAxes(t),c=this.getKeyframeTrackValues(a,t,n);s!==void 0&&(s=s.map(Pe.degToRad),s.push(i),s=new ht().fromArray(s),s=new de().setFromEuler(s)),r!==void 0&&(r=r.map(Pe.degToRad),r.push(i),r=new ht().fromArray(r),r=new de().setFromEuler(r).invert());const l=new de,h=new ht,u=[];for(let p=0;p<c.length;p+=3)h.set(c[p],c[p+1],c[p+2],i),l.setFromEuler(h),s!==void 0&&l.premultiply(s),r!==void 0&&l.multiply(r),l.toArray(u,p/3*4);return new Qn(e+".quaternion",a,u)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(r){return r/100}),s=Ee.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Fo(e.modelName+".morphTargetInfluences["+s+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,s){return n-s}),t.length>1){let n=1,s=t[0];for(let r=1;r<t.length;r++){const i=t[r];i!==s&&(t[n]=i,s=i,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const s=n,r=[];let i=-1,a=-1,c=-1;return e.forEach(function(l){if(t.x&&(i=t.x.times.indexOf(l)),t.y&&(a=t.y.times.indexOf(l)),t.z&&(c=t.z.times.indexOf(l)),i!==-1){const h=t.x.values[i];r.push(h),s[0]=h}else r.push(s[0]);if(a!==-1){const h=t.y.values[a];r.push(h),s[1]=h}else r.push(s[1]);if(c!==-1){const h=t.z.values[c];r.push(h),s[2]=h}else r.push(s[2])}),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],s=e.values[t]-n,r=Math.abs(s);if(r>=180){const i=r/180,a=s/i;let c=n+a;const l=e.times[t-1],u=(e.times[t]-l)/i;let p=l+u;const f=[],d=[];for(;p<e.times[t];)f.push(p),p+=u,d.push(c),c+=a;e.times=Eo(e.times,t,f),e.values=Eo(e.values,t,d)}}}}class Qa{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Pr,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(s,r){const i=s.match(/^[\s\t]*;/),a=s.match(/^[\s\t]*$/);if(i||a)return;const c=s.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),l=s.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=s.match("^\\t{"+(t.currentIndent-1)+"}}");c?t.parseNodeBegin(s,c):l?t.parseNodeProperty(s,l,n[++r]):h?t.popStack():s.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:n},i=this.parseNodeAttr(s),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,r):n in a?(n==="PoseNode"?a.PoseNode.push(r):a[n].id!==void 0&&(a[n]={},a[n][a[n].id]=a[n]),i.id!==""&&(a[n][i.id]=r)):typeof i.id=="number"?(a[n]={},a[n][i.id]=r):n!=="Properties70"&&(n==="PoseNode"?a[n]=[r]:a[n]=r),typeof i.id=="number"&&(r.id=i.id),i.name!==""&&(r.attrName=i.name),i.type!==""&&(r.attrType=i.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",s="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:n,type:s}}parseNodeProperty(e,t,n){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&r===","&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const i=this.getCurrentNode();if(i.name==="Properties70"){this.parseNodeSpecialProperty(e,s,r);return}if(s==="C"){const c=r.split(",").slice(1),l=parseInt(c[0]),h=parseInt(c[1]);let u=r.split(",").slice(3);u=u.map(function(p){return p.trim().replace(/^"/,"")}),s="connections",r=[l,h],oc(r,u),i[s]===void 0&&(i[s]=[])}s==="Node"&&(i.id=r),s in i&&Array.isArray(i[s])?i[s].push(r):s!=="a"?i[s]=r:i.a=r,this.setCurrentProp(i,s),s==="a"&&r.slice(-1)!==","&&(i.a=Vn(r))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Vn(t.a))}parseNodeSpecialProperty(e,t,n){const s=n.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=s[0],i=s[1],a=s[2],c=s[3];let l=s[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Vn(l);break}this.getPrevNode()[r]={type:i,type2:a,flag:c,value:l},this.setCurrentProp(this.getPrevNode(),r)}}class Ja{parse(e){const t=new wo(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const s=new Pr;for(;!this.endOfContent(t);){const r=this.parseNode(t,n);r!==null&&s.add(r.name,r)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},s=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const i=e.getUint8(),a=e.getString(i);if(s===0)return null;const c=[];for(let p=0;p<r;p++)c.push(this.parseProperty(e));const l=c.length>0?c[0]:"",h=c.length>1?c[1]:"",u=c.length>2?c[2]:"";for(n.singleProperty=r===1&&e.getOffset()===s;s>e.getOffset();){const p=this.parseNode(e,t);p!==null&&this.parseSubNode(a,n,p)}return n.propertyList=c,typeof l=="number"&&(n.id=l),h!==""&&(n.attrName=h),u!==""&&(n.attrType=u),a!==""&&(n.name=a),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const s=n.propertyList[0];Array.isArray(s)?(t[n.name]=n,n.a=s):t[n.name]=s}else if(e==="Connections"&&n.name==="C"){const s=[];n.propertyList.forEach(function(r,i){i!==0&&s.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(s)}else if(n.name==="Properties70")Object.keys(n).forEach(function(r){t[r]=n[r]});else if(e==="Properties70"&&n.name==="P"){let s=n.propertyList[0],r=n.propertyList[1];const i=n.propertyList[2],a=n.propertyList[3];let c;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?c=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:c=n.propertyList[4],t[s]={type:r,type2:i,flag:a,value:c}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),r=e.getUint32(),i=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}typeof za=="undefined"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=nn(new Uint8Array(e.getArrayBuffer(i))),c=new wo(a.buffer);switch(t){case"b":case"c":return c.getBooleanArray(s);case"d":return c.getFloat64Array(s);case"f":return c.getFloat32Array(s);case"i":return c.getInt32Array(s);case"l":return c.getInt64Array(s)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class wo{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let s=0;s<e;s++)t[s]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),Ne.decodeText(new Uint8Array(t))}}class Pr{add(e,t){this[e]=t}}function ec(o){const e="Kaydara FBX Binary  \0";return o.byteLength>=e.length&&e===kr(o,0,e.length)}function tc(o){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(s){const r=o[s-1];return o=o.slice(t+s),t++,r}for(let s=0;s<e.length;++s)if(n(1)===e[s])return!1;return!0}function bo(o){const e=/FBXVersion: (\d+)/,t=o.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function nc(o){return o/46186158e3}const sc=[];function wn(o,e,t,n){let s;switch(n.mappingType){case"ByPolygonVertex":s=o;break;case"ByPolygon":s=e;break;case"ByVertice":s=t;break;case"AllSame":s=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(s=n.indices[s]);const r=s*n.dataSize,i=r+n.dataSize;return rc(sc,n.buffer,r,i)}const qn=new ht,Et=new A;function Rr(o){const e=new Q,t=new Q,n=new Q,s=new Q,r=new Q,i=new Q,a=new Q,c=new Q,l=new Q,h=new Q,u=new Q,p=new Q,f=o.inheritType?o.inheritType:0;if(o.translation&&e.setPosition(Et.fromArray(o.translation)),o.preRotation){const x=o.preRotation.map(Pe.degToRad);x.push(o.eulerOrder),t.makeRotationFromEuler(qn.fromArray(x))}if(o.rotation){const x=o.rotation.map(Pe.degToRad);x.push(o.eulerOrder),n.makeRotationFromEuler(qn.fromArray(x))}if(o.postRotation){const x=o.postRotation.map(Pe.degToRad);x.push(o.eulerOrder),s.makeRotationFromEuler(qn.fromArray(x)),s.invert()}o.scale&&r.scale(Et.fromArray(o.scale)),o.scalingOffset&&a.setPosition(Et.fromArray(o.scalingOffset)),o.scalingPivot&&i.setPosition(Et.fromArray(o.scalingPivot)),o.rotationOffset&&c.setPosition(Et.fromArray(o.rotationOffset)),o.rotationPivot&&l.setPosition(Et.fromArray(o.rotationPivot)),o.parentMatrixWorld&&(u.copy(o.parentMatrix),h.copy(o.parentMatrixWorld));const d=t.clone().multiply(n).multiply(s),m=new Q;m.extractRotation(h);const g=new Q;g.copyPosition(h);const w=g.clone().invert().multiply(h),y=m.clone().invert().multiply(w),v=r,S=new Q;if(f===0)S.copy(m).multiply(d).multiply(y).multiply(v);else if(f===1)S.copy(m).multiply(y).multiply(d).multiply(v);else{const O=new Q().scale(new A().setFromMatrixScale(u)).clone().invert(),C=y.clone().multiply(O);S.copy(m).multiply(d).multiply(C).multiply(v)}const E=l.clone().invert(),_=i.clone().invert();let T=e.clone().multiply(c).multiply(l).multiply(t).multiply(n).multiply(s).multiply(E).multiply(a).multiply(i).multiply(r).multiply(_);const M=new Q().copyPosition(T),R=h.clone().multiply(M);return p.copyPosition(R),T=p.clone().multiply(S),T.premultiply(h.invert()),T}function Cr(o){o=o||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return o===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[o]}function Vn(o){return o.split(",").map(function(t){return parseFloat(t)})}function kr(o,e,t){return e===void 0&&(e=0),t===void 0&&(t=o.byteLength),Ne.decodeText(new Uint8Array(o,e,t))}function oc(o,e){for(let t=0,n=o.length,s=e.length;t<s;t++,n++)o[n]=e[t]}function rc(o,e,t,n){for(let s=t,r=0;s<n;s++,r++)o[r]=e[s];return o}function Eo(o,e,t){return o.slice(0,e).concat(t).concat(o.slice(e))}const Qu=new A,Ju=new A,eh=new A,th=new A,nh=new A,sh=new ne;var j=(o=>(o.GLTFloaded="GLTFloaded",o.AnimationsReady="AnimationsReady",o.Render="Render",o.RemoveRender="RemoveRender",o.AnimationMixerLoaded="AnimationMixer",o.ChangGeometry="ChangGeometry",o.ChangTexture="ChangTexture",o.ChangMaterial="ChangMaterial",o.RemoveMesh="RemoveMesh",o.ChangMesh="ChangMesh",o.AddObject3d="AddObject3d",o.RenderSizeChang="RenderSizeChang",o))(j||{}),ce=(o=>(o.onClick="click",o.onPointerOver="pointerover",o.onPointerOut="pointerout",o.onPointerMove="pointermove",o.onPointerDown="pointerdown",o.onPointerUp="pointerup",o.onWheel="wheel",o.onDblClick="dblclick",o.onPointerMissed="pointermissed",o.onKeyMissed="keymissed",o.None="none",o.onKeyDown="keydown",o.onKeyup="keyup",o.onKeypress="keypress",o.onContextmenu="contextmenu",o))(ce||{}),Dr=(o=>(o[o.LoopOnce=2200]="LoopOnce",o[o.LoopRepeat=2201]="LoopRepeat",o[o.LoopPingPong=2202]="LoopPingPong",o))(Dr||{}),Te=(o=>(o.isMesh="isMesh",o.isGroup="isGroup",o.isFBX="isFBX",o.isGLTF="isGLTF",o))(Te||{});class Nr extends qe{constructor(e=document.createElement("div")){super(),this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}Nr.prototype.isCSS2DObject=!0;const et=new A,So=new Q,Mo=new Q,To=new A,xo=new A;class ic{constructor(e={}){const t=this;let n,s,r,i;const a={objects:new WeakMap},c=e.element!==void 0?e.element:document.createElement("div");c.style.overflow="hidden",this.domElement=c,this.getSize=function(){return{width:n,height:s}},this.render=function(f,d){f.autoUpdate===!0&&f.updateMatrixWorld(),d.parent===null&&d.updateMatrixWorld(),So.copy(d.matrixWorldInverse),Mo.multiplyMatrices(d.projectionMatrix,So),l(f,f,d),p(f)},this.setSize=function(f,d){n=f,s=d,r=n/2,i=s/2,c.style.width=f+"px",c.style.height=d+"px"};function l(f,d,m){if(f.isCSS2DObject){et.setFromMatrixPosition(f.matrixWorld),et.applyMatrix4(Mo);const g=f.visible===!0&&et.z>=-1&&et.z<=1&&f.layers.test(m.layers)===!0;if(f.element.style.display=g===!0?"":"none",g===!0){f.onBeforeRender(t,d,m);const y=f.element;/apple/i.test(navigator.vendor)?y.style.transform="translate(-50%,-50%) translate("+Math.round(et.x*r+r)+"px,"+Math.round(-et.y*i+i)+"px)":y.style.transform="translate(-50%,-50%) translate("+(et.x*r+r)+"px,"+(-et.y*i+i)+"px)",y.parentNode!==c&&c.appendChild(y),f.onAfterRender(t,d,m)}const w={distanceToCameraSquared:h(m,f)};a.objects.set(f,w)}for(let g=0,w=f.children.length;g<w;g++)l(f.children[g],d,m)}function h(f,d){return To.setFromMatrixPosition(f.matrixWorld),xo.setFromMatrixPosition(d.matrixWorld),To.distanceToSquared(xo)}function u(f){const d=[];return f.traverse(function(m){m.isCSS2DObject&&d.push(m)}),d}function p(f){const d=u(f).sort(function(g,w){if(g.renderOrder!==w.renderOrder)return w.renderOrder-g.renderOrder;const y=a.objects.get(g).distanceToCameraSquared,v=a.objects.get(w).distanceToCameraSquared;return y-v}),m=d.length;for(let g=0,w=d.length;g<w;g++)d[g].element.style.zIndex=m-g}}}class ac extends Uo{constructor(e){super(e),this.callBack=[],this.clock=new Ii}init(e,t){t.addEventListenerById(e,j.Render,n=>{this.setCallBack(n.render)}),t.addEventListenerById(e,j.RemoveRender,n=>{this.delCallBack(n.render)})}setScene(e){this.scene=e}setCamera(e){this.camera=e}getScene(){return this.scene}getCamera(){return this.camera}setCallBack(e){this.callBack.push(e)}delCallBack(e){this.callBack=this.callBack.filter(t=>t!=e)}enableCss2D(e){var t,n;if(e&&!this.css2DRenderer){const s=new he;this.getSize(s),this.css2DRenderer=new ic,this.css2DRenderer.setSize(s.x,s.y),this.css2DRenderer.domElement.style.position="absolute",this.css2DRenderer.domElement.style.top="0px",(t=this.domElement.parentElement)==null||t.appendChild(this.css2DRenderer.domElement)}else(n=this.domElement.parentElement)==null||n.removeChild(this.css2DRenderer.domElement),this.css2DRenderer=null}setRenderSize(e,t){this.setSize(e,t),this.css2DRenderer&&this.css2DRenderer.setSize(e,t)}renderScene(){const e=this.clock.getDelta();this.callBack.forEach(t=>{try{t(e,Or())}catch(n){console.error("WebGLRendererCallBack:",n)}}),this.scene&&this.camera?(this.css2DRenderer&&this.css2DRenderer.render(this.scene,this.camera),this.render(this.scene,this.camera)):console.warn("not found any camera scene"),requestAnimationFrame(this.renderScene.bind(this))}}const Y=(o,e)=>(e.install=t=>{t.component(o,e)},e),V=()=>{const o=es();if(o)return o.appContext.config.globalProperties.$getv3dCore();throw Error("Sandi-ui:Core\u5B9E\u4F8B\u83B7\u53D6\u9519\u8BEF")},Or=()=>(typeof performance=="undefined"?Date:performance).now(),cc=(o,e)=>{let t=o;switch(e){case Te.isMesh:t=o;break;case Te.isGroup:t=o;break;case Te.isFBX:o&&o.object3d?t=o.object3d:t=null;break;case Te.isGLTF:o.gltf&&o.gltf.scene?t=o.gltf.scene:t=null;break}return t},Fr=(o,e,t=!1)=>{let n=[];return o.reduce((s,r)=>{const i=e.find(a=>r[a]);if(i)if(t){let a=cc(r,i);a&&s.push(a)}else s.push(r);return s},n)},jr=o=>{if(o.isMesh)return!0},lc=o=>{if(o instanceof ts)return!0},Br=(o,e)=>{let t=[];return Object.keys(e).forEach(n=>{const s=o[n],r=e[n];s!==r&&typeof s==typeof r&&t.push(n)}),t},On=o=>{Object.keys(o).forEach(e=>{o[e]instanceof Qt&&o[e].dispose()})},zr=o=>{o.material instanceof pt&&(On(o.material),o.material.dispose()),o.geometry&&o.geometry.dispose()},Ur=o=>{let e=[o],t=new Set;for(;e.length!=0;){const n=e.pop();(n==null?void 0:n.children)&&n.children.length>0&&n.children.forEach(s=>{t.has(s)||(e.push(s),t.add(s))}),n instanceof L?zr(n):n.dispose&&n.dispose()}},uc=(o,e,t)=>{const n=V();let s,r=[];const{parentId:i,id:a}=n.addNode({}),c=g=>{let w;switch(typeof g){case"string":w=r.find(y=>y.name==g);break;case"number":w=r[g];break;default:w=r[0]}o&&w?(s&&s.stop(),s=o.clipAction(w),s.play(),n.setNode(a,s)):console.log("anmiations action not found")},l=g=>{s.weight=g},h=g=>{s.timeScale=g},u=(g,w)=>{s.setLoop(g,w)},p=g=>{switch(g){case"play":s.play();break;case"stop":s.stop();break;case"reset":s.reset();break;default:s.play()}},f=(g,w,y,v,S)=>{l(g),h(w),u(y,v),p(S)},d=()=>s;return i&&n.addEventListenerById(i,j.AnimationMixerLoaded,g=>{const{mixer:w,animations:y}=g;o=w,r=y,c(t.id);const{weight:v,timeScale:S,loopMode:E,loop:_,statue:T}=t;f(v,S,E,_,T)}),{getInstance:d,setAnimationClip:c,setWeight:l,setProps:f,remove:()=>{n.delNode(a)}}};var Z=(o,e)=>{const t=o.__vccOpts||o;for(const[n,s]of e)t[n]=s;return t};const hc=K({props:{id:{type:[Number,String],default:0},weight:{type:Number,default:1},timeScale:{type:Number,default:1},loopMode:{type:Number,default:Dr.LoopRepeat},loop:{type:Number,default:1/0},statue:{type:String,default:"play"}},setup(o){const{getInstance:e,setAnimationClip:t,setProps:n,remove:s}=uc(void 0,void 0,o);return B(()=>o.id,(r,i)=>{const{weight:a,timeScale:c,loopMode:l,loop:h,statue:u}=o;t(r),n(a,c,l,h,u)}),B(o,r=>{const{weight:i,timeScale:a,loopMode:c,loop:l,statue:h}=r;n(i,a,c,l,h)}),Ye(()=>{e()}),J(()=>{s()}),{getInstance:e}}});function pc(o,e,t,n,s,r){return le(o.$slots,"default")}var fc=Z(hc,[["render",pc],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/animation-action/src/AnimationAction.vue"]]);const dc=Y("SDAnimationAction",fc),bn="SANDI_UID",mt="SANDI_RENDER_ID",Gr="SCENE_ID",mc=()=>{const o=V();let e,t;const{parentId:n,id:s}=o.addNode({}),r=Oe(mt),i=()=>e,a=()=>{r&&t&&o.dispatchEventById(r,{type:j.RemoveRender,render:t})};return n&&o.addEventListenerById(n,j.AnimationsReady,l=>{const{object3d:h,animations:u}=l.payload;e=new Li(h),t=p=>{e.update(p)},o.setNode(s,e),r&&o.dispatchEventById(r,{type:j.Render,render:t}),o.dispatchEventById(s,{type:j.AnimationMixerLoaded,mixer:e,animations:u})}),{getInstance:i,removeRender:a,remove:()=>{o.delNode(s)}}},gc=K({props:{id:{type:Number,default:0}},setup(){const{getInstance:o,remove:e}=mc();J(()=>{e()})}});function yc(o,e,t,n,s,r){return le(o.$slots,"default")}var vc=Z(gc,[["render",yc],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/animation-aixer/src/AnimationMixer.vue"]]);const wc=Y("SDAnimationMixer",vc),bc=(o,e,t,n,s,r)=>{const i=V();let a=new fe(o,e,t,n,s,r);const{parentId:c,id:l}=i.addNode(a);return c&&i.dispatchEventById(c,{type:j.ChangGeometry,geometry:a}),{getInstance:()=>a,remove:()=>{a.dispose(),i.delNode(l)},replace:f=>{if(c){const{width:d,height:m,depth:g,widthSegments:w,heightSegments:y,depthSegments:v}=f,S=new fe(d,m,g,w,y,v);i.dispatchEventById(c,{type:j.ChangGeometry,geometry:S}),i.setNode(l,S),a.dispose(),a=S}}}},Ec=K({props:{width:Number,height:Number,depth:Number,widthSegments:Number,heightSegments:Number,depthSegments:Number},setup(o){const{width:e,height:t,depth:n,widthSegments:s,heightSegments:r,depthSegments:i}=o;let{getInstance:a,remove:c,replace:l}=bc(e,t,n,s,r,i);B(o,(h,u)=>{l(o)}),J(()=>{c()})}});function Sc(o,e,t,n,s,r){return le(o.$slots,"default")}var Mc=Z(Ec,[["render",Sc],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/box-geometry/src/BoxGeometry.vue"]]);const Tc=Y("SDBoxGeometry",Mc),xc=(o,e,t,n)=>{const s=V();let r=new Zn(o,e,t,n);const{parentId:i,id:a}=s.addNode(r);return i&&s.dispatchEventById(i,{type:j.ChangGeometry,geometry:r}),{getInstance:()=>r,remove:()=>{r.dispose(),s.delNode(a)},replace:u=>{if(i){const{width:p,height:f,depth:d,widthSegments:m}=u,g=new Zn(p,f,d,m);s.dispatchEventById(i,{type:j.ChangGeometry,geometry:g}),s.setNode(a,g),r.dispose(),r=g}}}},_c=K({props:{width:Number,height:Number,widthSegments:Number,heightSegments:Number},setup(o){const{width:e,height:t,widthSegments:n,heightSegments:s}=o;let{getInstance:r,remove:i,replace:a}=xc(e,t,n,s);B(o,(c,l)=>{a(o)}),J(()=>{i()})}});function Ac(o,e,t,n,s,r){return le(o.$slots,"default")}var Ic=Z(_c,[["render",Ac],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/plane-geometry/src/PlaneGeometry.vue"]]);const Lc=Y("SDPlaneGeometry",Ic),Pc=(o,e,t,n)=>{const s=V();let r=new Xs(o,e,t,n);const{parentId:i,id:a}=s.addNode(r);return i&&s.dispatchEventById(i,{type:j.ChangGeometry,geometry:r}),{getInstance:()=>r,remove:()=>{r.dispose(),s.delNode(a)},replace:u=>{if(i){const{radius:p,length:f,capSubdivisions:d,radialSegments:m}=u,g=new Xs(p,f,d,m);s.dispatchEventById(i,{type:j.ChangGeometry,geometry:g}),s.setNode(a,g),r.dispose(),r=g}}}},Rc=K({props:{radius:Number,length:Number,capSubdivisions:Number,radialSegments:Number},setup(o){const{radius:e,length:t,capSubdivisions:n,radialSegments:s}=o;let{getInstance:r,remove:i,replace:a}=Pc(e,t,n,s);B(o,(c,l)=>{a(o)}),J(()=>{i()})}});function Cc(o,e,t,n,s,r){return le(o.$slots,"default")}var kc=Z(Rc,[["render",Cc],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/capsule-geometry/src/CapsuleGeometry.vue"]]);const Dc=Y("SDCapsuleGeometry",kc),Nc=(o,e,t,n,s,r,i)=>{const a=V();let c=new qs(o,e,t,n,s,r,i);const{parentId:l,id:h}=a.addNode(c);return l&&a.dispatchEventById(l,{type:j.ChangGeometry,geometry:c}),{getInstance:()=>c,remove:()=>{c.dispose(),a.delNode(h)},replace:d=>{if(l){const{height:m,radialSegments:g,heightSegments:w,openEnded:y,thetaStart:v,thetaLength:S}=d,E=new qs(m,g,w,y,v,S);a.dispatchEventById(l,{type:j.ChangGeometry,geometry:E}),a.setNode(h,E),c.dispose(),c=E}}}},Oc=K({props:{radius:Number,height:Number,radialSegments:Number,heightSegments:Number,openEnded:Boolean,thetaStart:Number,thetaLength:Number},setup(o){const{radius:e,height:t,radialSegments:n,heightSegments:s,openEnded:r,thetaStart:i,thetaLength:a}=o;let{getInstance:c,remove:l,replace:h}=Nc(e,t,n,s,r,i,a);B(o,(u,p)=>{h(o)}),J(()=>{l()})}});function Fc(o,e,t,n,s,r){return le(o.$slots,"default")}var jc=Z(Oc,[["render",Fc],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/cone-geometry/src/ConeGeometry.vue"]]);const Bc=Y("SDConeGeometry",jc),zc=(o,e,t,n,s,r,i,a)=>{const c=V();let l=new ye(o,e,t,n,s,r,i,a);const{parentId:h,id:u}=c.addNode(l);return h&&c.dispatchEventById(h,{type:j.ChangGeometry,geometry:l}),{getInstance:()=>l,remove:()=>{l.dispose(),c.delNode(u)},replace:m=>{if(h){const{radiusTop:g,radiusBottom:w,height:y,radialSegments:v,heightSegments:S,openEnded:E,thetaStart:_,thetaLength:T}=m,M=new ye(g,w,y,v,S,E,_,T);c.dispatchEventById(h,{type:j.ChangGeometry,geometry:M}),c.setNode(u,M),l.dispose(),l=M}}}},Uc=K({props:{radiusTop:Number,radiusBottom:Number,height:Number,radialSegments:Number,heightSegments:Number,openEnded:Boolean,thetaStart:Number,thetaLength:Number},setup(o){const{radiusTop:e,radiusBottom:t,height:n,radialSegments:s,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:c}=o;let{getInstance:l,remove:h,replace:u}=zc(e,t,n,s,r,i,a,c);B(o,(p,f)=>{u(o)}),J(()=>{h()})}});function Gc(o,e,t,n,s,r){return le(o.$slots,"default")}var Hc=Z(Uc,[["render",Gc],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/cylinder-geometry/src/CylinderGeometry.vue"]]);const $c=Y("SDCylinderGeometry",Hc),Xc=o=>{const e=V(),{parentId:t,id:n}=e.addNode(o);t&&e.dispatchEventById(t,{type:j.ChangGeometry,geometry:o});const s=a=>{t&&(e.dispatchEventById(t,{type:j.ChangGeometry,geometry:a}),e.setNode(n,a),o=a)};return{changGeometry:s,remove:()=>{o.dispose(),e.delNode(n)},getInstance:()=>s}},qc=K({props:{geometry:{type:$e,required:!0}},setup(o){const{remove:e,changGeometry:t}=Xc(o.geometry);B(()=>o.geometry,(n,s)=>{t(o.geometry)}),J(()=>{e()})}});function Vc(o,e,t,n,s,r){return le(o.$slots,"default")}var Kc=Z(qc,[["render",Vc],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/geometry/src/Geometry.vue"]]);const oh=Y("SDGeometry",Kc),Yc=(o,e)=>{const t=V(),n=new gs(o,e),{parentId:s,id:r}=t.addNode(n);return s&&t.getNode(s).node.add(n),{instance:n,remove:()=>{n.dispose(),t.delNode(r)}}},Zc=K({props:{color:{type:Number,defaule:16777215},intensity:{type:Number,defaule:2}},setup(o){const{instance:e,remove:t}=Yc(o.color,o.intensity);J(()=>t())}}),Wc={ref:"rendererDom"};function Qc(o,e,t,n,s,r){return Pt(),Rt("div",Wc,null,512)}var Jc=Z(Zc,[["render",Qc],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/directional-light/src/DirectionalLight.vue"]]);const el=Y("SDDirectionalLight",Jc),tl=(o,e,t,n,s,r)=>{const i=V(),a=new ms(o,e,t,n,s,r);i.addNode(a);const{parentId:c,id:l}=i.addNode(a);return c&&i.getNode(c).node.add(a),{instance:a}},nl=K({props:{color:{type:Number,defaule:16777215},intensity:{type:Number,defaule:1},distance:{type:Number,defaule:0},angle:{type:Number,defaule:2},penumbra:{type:Number,defaule:0},decay:{type:Number,defaule:1}},setup(o){const{instance:e}=tl(o.color,o.intensity,o.distance,o.angle,o.penumbra,o.decay);J(()=>{e.dispose()})}}),sl={ref:"rendererDom"};function ol(o,e,t,n,s,r){return Pt(),Rt("div",sl,null,512)}var rl=Z(nl,[["render",ol],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/spot-light/src/SpotLight.vue"]]);const il=Y("SDSpotLight",rl),al=(o,e,t,n)=>{const s=V(),r=new _n(o,e,t,n);s.addNode(r);const{parentId:i,id:a}=s.addNode(r);return i&&s.getNode(i).node.add(r),{instance:r}},cl=K({props:{color:{type:Number,defaule:16777215},intensity:{type:Number,defaule:1},distance:{type:Number,defaule:0},decay:{type:Number,defaule:2}},setup(o){al(o.color,o.intensity,o.distance,o.decay),Ye(()=>{})}}),ll={ref:"rendererDom"};function ul(o,e,t,n,s,r){return Pt(),Rt("div",ll,null,512)}var hl=Z(cl,[["render",ul],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/point-light/src/PointLight.vue"]]);const pl=Y("SDPointLight",hl),fl=o=>{const e=V();let t=new Map;const n=new Vi,{parentId:s,id:r}=e.addNode({isGLTF:!0,isload:!1}),i=e.getParent();let a;const c=(h,u,p)=>{h.forEach(f=>{f.traverse(d=>{d&&d.type=="SkinnedMesh"&&d.name==p&&(d.material=u)})})};n.load(o,h=>{const{scene:u}=h;i&&(i.node.add(u),i.node.isObject3D&&u.traverse(p=>{p.userData={primitive:!0,parentId:i.id}}),e.dispatchEventById(r,{type:j.AnimationsReady,payload:{object3d:h.scene,animations:h.animations}}),e.setNode(r,{isGLTF:!0,gltf:h,isload:!0}),a=h),t.size!==0&&t.forEach((p,f)=>{c(h.scene.children,p,f)})});const l=()=>{e.delNode(r),a&&(a.scenes.forEach(h=>{h.children.forEach(u=>Ur(u))}),a.cameras.forEach(h=>h.dispose()))};return e.addEventListenerById(r,j.ChangMaterial,h=>{const{material:u,key:p}=h;p&&u&&(t.set(p,u),a&&c(a.scene.children,u,p))}),{instance:n,remove:l}},dl=K({props:{url:{type:String,required:!0}},setup(o){const{instance:e,remove:t}=fl(o.url);return J(()=>{t()}),{instance:e}}});function ml(o,e,t,n,s,r){return le(o.$slots,"default")}var gl=Z(dl,[["render",ml],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/gltf-loader/src/GLTFLoader.vue"]]);const yl=Y("SDGLTFLoader",gl),vl=o=>{const e=V();let t=new Map,n=new Map,s=null;const{parentId:r,id:i}=e.addNode({isFBX:!0,isload:!1}),a=e.getParent(),c=(f,d,m)=>{const g=f.find(w=>{if(w.type=="SkinnedMesh"&&w.name==m)return w});g&&(g.material=d)},l=(f,d)=>{let m=[...f];for(;m.length!=0;){const g=m.pop();if((g==null?void 0:g.name)==d)return g;g!=null&&g.children&&g.children.forEach(w=>{w.type==="Bone"&&m.push(w)})}return null},h=(f,d,m)=>{let g=l(f,m);g==null||g.add(d)};e.addEventListenerById(i,j.ChangMaterial,f=>{const{material:d,key:m}=f;m&&d&&(t.set(m,d),s&&c(s.children,d,m))}),e.addEventListenerById(i,j.ChangMesh,f=>{const{mesh:d,key:m}=f;m&&d&&(n.set(m,d),s&&h(s.children.filter(g=>g.type=="Bone"),d,m))});const u=new Ka;return u.load(o,f=>{a&&(s=f,a.node.add(f),a.node.isObject3D&&f.traverse(d=>{d.userData={primitive:!0,parentId:a.id}}),e.dispatchEventById(i,{type:j.AnimationsReady,payload:{object3d:f,animations:f.animations}}),e.setNode(i,{isFBX:!0,object3d:f,isload:!0}),t.size!==0&&t.forEach((d,m)=>{c(f.children,d,m)}))}),{instance:u,remove:()=>{e.delNode(i),s&&s.children.forEach(f=>{Ur(f)})}}},wl=K({props:{url:{type:String,required:!0}},setup(o){const{instance:e,remove:t}=vl(o.url);return J(()=>{t()}),{instance:e}}});function bl(o,e,t,n,s,r){return le(o.$slots,"default")}var El=Z(wl,[["render",bl],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/fbx-loader/src/FBXLoader.vue"]]);const Sl=Y("SDFBXLoader",El),Ml=()=>{const o=V(),e=new vs,{parentId:t,id:n}=o.addNode(e);return{instance:e,setTexture:(r,i)=>{if(t){const a=o.getNode(t);a.node instanceof pt?a.node[i]=r:console.warn(`parent node dont have ${i}`)}},loadAsync:e.loadAsync.bind(e)}},Tl=K({props:{type:{type:String,required:!0},url:{type:String,required:!0},disabled:Boolean},setup(o){const{instance:e,setTexture:t}=Ml(),n=e.load(o.url);return o.disabled||t(n,o.type),B(()=>o.disabled,s=>{s||t(n,o.type)}),J(()=>{n.dispose()}),{instance:e}}});function xl(o,e,t,n,s,r){return le(o.$slots,"default")}var _l=Z(Tl,[["render",xl],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/texture-loader/src/TextureLoader.vue"]]);const Al=Y("SDTextureLoader",_l),Il=(o,e,t,n={})=>{const s=V();let r;!o&&!t&&(o=new fe(1,1,1)),e||(e=new He({color:65280}));let i=new L(o,e);i.userData.sandiClick=i.uuid;const{parentId:a,id:c}=s.addNode(i),l=d=>{if(a){const{node:m}=s.getNode(a),{material:g,children:w,position:y,rotation:v,scale:S}=i;m==null||m.remove(i),i.uuid,i=new L(d,g),i.position.set(y.x,y.y,y.z),i.rotation.set(v.x,v.y,v.z),i.scale.set(S.x,S.y,S.z),m==null||m.add(i),w.forEach(E=>{i.add(E)}),s.setNode(c,i),i.userData.sandiClick=i.uuid}},h=d=>{i.material=d};return s.addEventListenerById(c,j.ChangMaterial,d=>{const{material:m}=d;h(m)}),s.addEventListenerById(c,j.ChangGeometry,d=>{const{geometry:m}=d;l(m),r(i)}),s.addEventListenerById(c,j.AddObject3d,d=>{const{object3d:m}=d;i.add(m)}),a&&s.dispatchEventById(a,{type:j.AddObject3d,object3d:i}),{id:c,getInstance:()=>i,update:d=>{r=d},changGeometry:l,ChangMaterial:h,remove:()=>{s.delNode(c),zr(i)}}};let It=["onClick","onPointerMove","onPointerDown","onPointerUp","onWheel","onDblClick","onKeyDown","onKeyup","onKeypress","onContextmenu","onPointerOut","onPointerOver","onPointerMissed","onKeyMissed"];const Ll=It.filter(o=>!["onKeyMissed","onPointerMissed"].includes(o)).map(o=>o.replace("on","onGL"));It=It.concat(Ll);const Hr=It.reduce((o,e)=>(o[e]={type:Function,required:!1},o),{}),$r=(o,e)=>{const t=V();return It.forEach(n=>{const s=n.replace("on","").toLowerCase();o[n]&&t.setEvenet(s,e,o[n]),B(()=>o[n],(r,i)=>{typeof r=="function"?t.setEvenet(s,e,r):t.delEvenet(s,e)})}),()=>{It.forEach(n=>{const s=n.replace("on","").toLowerCase();t.delEvenet(s,e)})}},un={name:{type:String,require:!1},position:{type:[Array,String],require:!1},rotation:{type:[Array,String],require:!1},scale:{type:[Array,String],require:!1},translateX:{type:Number,require:!1},translateY:{type:Number,require:!1},translateZ:{type:Number,require:!1},rotateX:{type:Number,require:!1},rotateY:{type:Number,require:!1},rotateZ:{type:Number,require:!1},rotationX:{type:Number,require:!1},rotationY:{type:Number,require:!1},rotationZ:{type:Number,require:!1},positionX:{type:Number,require:!1},positionY:{type:Number,require:!1},positionZ:{type:Number,require:!1},scaleX:{type:Number,require:!1},scaleY:{type:Number,require:!1},scaleZ:{type:Number,require:!1},scaleXYZ:{type:Number,require:!1},visible:{type:Boolean,require:!1}},Dn=(o,e)=>{o.add(e)},_o=o=>typeof o=="function",Ao=o=>typeof o=="string"?o.split(",").map(e=>parseFloat(e)):o instanceof Array&&o.length>=0?o:[0,0,0],Ue=(o,e,t,n,s,r)=>{t[s]&&(e[n]&&(t[s][r]=e[n]),Dn(o,B(()=>e[n],(i,a)=>{t[s][r]=i})))},Kn=(o,e,t,n)=>{if(t[n]){if(e[n]){const[s,r,i]=Ao(e[n]);t[n].set(s,r,i)}Dn(o,B(()=>e[n],(s,r)=>{const[i,a,c]=Ao(s);t[n].set(i,a,c)}))}},on=(o,e)=>{const t=new Set,n={position:(s,r)=>{Kn(t,s,r,"position")},rotation:(s,r)=>{Kn(t,s,r,"rotation")},scale:(s,r)=>{Kn(t,s,r,"scale")},positionX:(s,r)=>{Ue(t,s,r,"positionX","position","x")},positionY:(s,r)=>{Ue(t,s,r,"positionY","position","y")},positionZ:(s,r)=>{Ue(t,s,r,"positionZ","position","z")},rotationX:(s,r)=>{Ue(t,s,r,"rotationX","rotation","x")},rotationY:(s,r)=>{Ue(t,s,r,"rotationY","rotation","y")},rotationZ:(s,r)=>{Ue(t,s,r,"rotationZ","rotation","z")},scaleX:(s,r)=>{Ue(t,s,r,"scaleX","scale","x")},scaleY:(s,r)=>{Ue(t,s,r,"scaleY","scale","y")},scaleZ:(s,r)=>{Ue(t,s,r,"scaleZ","scale","z")},scaleXYZ:(s,r,i,a)=>{if(s.scaleXYZ){let c=s.scaleXYZ;r.scale.set(c,c,c)}Dn(t,B(()=>s.scaleXYZ,(c,l)=>{r.scale.set(c,c,c)}))}};for(let s in un)n[s]?n[s](o,e):s in e?(o[s]&&(_o(e[s])?e[s](o[s]):e[s]=o[s]),Dn(t,B(()=>o[s],r=>{_o(e[s])?e[s](r):e[s]=r}))):(console.log("instance:",e),console.log("instance not have props ",s));return()=>{t.forEach(s=>{s()})}},Pl=K({props:at(be(be({},un),Hr),{geometry:{type:$e,required:!1},material:{type:pt,required:!1},geometryType:{type:String,required:!1},geometryParam:{type:Object,required:!1}}),setup(o){const{getInstance:e,update:t,changGeometry:n,ChangMaterial:s,remove:r,id:i}=Il(o.geometry,o.material,o.geometryType,o.geometryParam);let a=on(o,e());const c=h=>{a(),a=on(o,h)};let l=$r(o,i);return B(()=>o.geometry,h=>{h&&n(h)}),B(()=>o.material,h=>{h&&s(h)}),t(c),J(()=>{r(),l(),a()}),{getInstance:e}}});function Rl(o,e,t,n,s,r){return le(o.$slots,"default")}var Cl=Z(Pl,[["render",Rl],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/mesh/src/Mesh.vue"]]);const kl=Y("SDMesh",Cl),Dl=o=>{const e=V();let t=new Tt;t.userData.sandiClick=t.uuid;const{parentId:n,id:s}=e.addNode(t);return e.addEventListenerById(s,j.AddObject3d,a=>{const{object3d:c}=a;t.add(c)}),n&&e.dispatchEventById(n,{type:j.AddObject3d,object3d:t}),{getInstance:()=>t,id:s,remove:()=>{e.delNode(s)}}},Nl=K({props:at(be(be({},un),Hr),{click:{type:Function,required:!1},pointerOver:{type:Function,required:!1},pointerOut:{type:Function,required:!1}}),setup(o){const{getInstance:e,remove:t,id:n}=Dl(o.click);e().position.set(0,0,0),on(o,e());let s=$r(o,n);return J(()=>{}),J(()=>{t(),s()}),{getInstance:e}}});function Ol(o,e,t,n,s,r){return le(o.$slots,"default")}var Fl=Z(Nl,[["render",Ol],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/group/src/Group.vue"]]);const jl=Y("SDGroup",Fl),Bl=()=>{const o=V(),e=new Go,{parentId:t,id:n}=o.addNode(e);return t&&o.getNode(t).node.setScene(e),o.addEventListenerById(n,j.AddObject3d,s=>{const{object3d:r}=s;e.add(r)}),{instance:e}},zl=K({setup(){const{instance:o}=Bl();return Ye(()=>{}),J(()=>{}),{instance:o}}});function Ul(o,e,t,n,s,r){return le(o.$slots,"default")}var Gl=Z(zl,[["render",Ul],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/scene/src/Scene.vue"]]);const Hl=Y("SDScene",Gl),$l=o=>{const e=V();o.meshName;const t=be({},o);delete t.meshName;const n=new He(t);n.needsUpdate=!0;const{parentId:s,id:r}=e.addNode(n);return s&&e.dispatchEventById(s,{type:j.ChangMaterial,material:n,key:o.meshName}),{instance:n,remove:()=>{On(n)}}},Xl=K({props:{color:{type:Number,default:16777215},map:{type:Object,default:null},alphaMap:{type:Object,default:null},aoMap:{type:Object,default:null},reflectivity:{type:Number,default:1},refractionRatio:{type:Number,default:.98},meshName:String},setup(o){const{instance:e,remove:t}=$l(o);return J(()=>{t()}),B(o,n=>{const{color:s,map:r,alphaMap:i,reflectivity:a,refractionRatio:c}=n;e.color=new ne(s),r&&(e.map=r),i&&(e.alphaMap=i),a&&(e.reflectivity=a),c&&(e.refractionRatio=c)}),{instance:e}}});function ql(o,e,t,n,s,r){return le(o.$slots,"default")}var Vl=Z(Xl,[["render",ql],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/mesh-basic-material/src/MeshBasicMaterial.vue"]]);const Kl=Y("SDMeshBasicMaterial",Vl),Yl=o=>{const e=V();o.meshName;const t=be({},o);delete t.meshName;const n=new zo(t);n.needsUpdate=!0;const{parentId:s,id:r}=e.addNode(n);return s&&e.dispatchEventById(s,{type:j.ChangMaterial,material:n,key:o.meshName}),{remove:()=>{On(n)},instance:n}},Zl=K({props:{alphaMap:{type:Object,default:null},aoMap:{type:Object,default:null},aoMapIntensity:{type:Number,default:1},color:{type:Number,default:16777215},combine:{type:Number,default:0},emissive:{type:Number,default:0},emissiveMap:{type:Object,default:null},emissiveIntensity:{type:Number,default:1},envMap:{type:Object,default:null},lightMap:{type:Number,default:1},lightMapIntensity:{type:Number,default:1},map:{type:Object,default:null},reflectivity:{type:Number,default:1},refractionRatio:{type:Number,default:.98},specularMap:{type:Object,default:null},wireframe:{type:Boolean,default:!1},wireframeLinecap:{type:String,default:"round"},wireframeLinejoin:{type:String,default:"round"},wireframeLinewidth:{type:Number,default:1},meshName:String},setup(o){const{instance:e,remove:t}=Yl(o);return J(()=>{t()}),B(o,(n,s)=>{Br(n,s).forEach(r=>{r=="color"?e.color=new ne(n[r]):e[r]=n[r]})}),{instance:e}}});function Wl(o,e,t,n,s,r){return le(o.$slots,"default")}var Ql=Z(Zl,[["render",Wl],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/mesh-lambert-material/src/MeshLambertMaterial.vue"]]);const Jl=Y("SDMeshLambertMaterial",Ql),eu=o=>{const e=V();o.meshName;const t=be({},o);delete t.meshName;const n=new En(t);n.needsUpdate=!0;const{parentId:s,id:r}=e.addNode(n);return s&&e.dispatchEventById(s,{type:j.ChangMaterial,material:n,key:o.meshName}),{remove:()=>{On(n)},instance:n}},tu=K({props:{alphaMap:{type:Object,default:null},aoMap:{type:Object,default:null},aoMapIntensity:{type:Number,default:1},bumpMap:{type:Object,default:null},bumpScale:{type:Number,default:1},color:{type:Number,default:16777215},combine:{type:Number,default:0},displacementMap:{type:Object,default:null},displacementScale:{type:Number,default:0},displacementBias:{type:Number,default:0},emissive:{type:Number,default:0},emissiveMap:{type:Object,default:null},emissiveIntensity:{type:Number,default:1},envMap:{type:Object,default:null},flatShading:{type:Boolean,default:!1},lightMap:{type:Number,default:1},lightMapIntensity:{type:Number,default:1},map:{type:Object,default:null},normalMap:{type:Object,default:null},normalMapType:{type:Number,default:1},normalScale:{type:he,default:new he(1,1)},reflectivity:{type:Number,default:1},refractionRatio:{type:Number,default:.98},shininess:{type:Number,default:30},specular:{type:Number,default:0},specularMap:{type:Object,default:null},wireframe:{type:Boolean,default:!1},wireframeLinecap:{type:String,default:"round"},wireframeLinejoin:{type:String,default:"round"},wireframeLinewidth:{type:Number,default:1},meshName:String},setup(o){const{instance:e,remove:t}=eu(o);return J(()=>{t()}),B(o,(n,s)=>{Br(n,s).forEach(r=>{r=="color"?e.color=new ne(n[r]):e[r]=n[r]})}),{instance:e}}});function nu(o,e,t,n,s,r){return le(o.$slots,"default")}var su=Z(tu,[["render",nu],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/mesh-phone-material/src/MeshPhoneMaterial.vue"]]);const rh=Y("SDMeshPhongMaterial",su),ou=(o,e)=>{const t=V(),{parentId:n,id:s}=t.addNode(o);return n&&t.dispatchEventById(n,{type:j.ChangMaterial,material:o,key:e}),{changMaterial:a=>{n&&t.dispatchEventById(n,{type:j.ChangMaterial,material:a,key:e})},remove:()=>{o.dispose(),t.delNode(s)}}},ru=K({props:{material:{type:pt,required:!0},disabled:{type:Boolean,required:!1},meshName:{type:String,required:!1}},setup(o){const{changMaterial:e,remove:t}=ou(o.material,o.meshName);B(()=>o.material,(n,s)=>{n&&e(n)}),B(()=>o.disabled,n=>{!n&&o.material&&e(o.material)}),J(()=>{t()})}});function iu(o,e,t,n,s,r){return le(o.$slots,"default")}var au=Z(ru,[["render",iu],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/material/src/Material.vue"]]);const ih=Y("SDMaterial",au),cu=(o,e,t,n)=>{const s=V();let r=new ws(o,e,t,n);const i=Oe(mt);if(typeof i=="number"){const a=s.getParent();a&&a.node.isObject3D&&a.node.add(r),s.addNode(r);const c=s.getNode(i);c.node.setCamera(r);const l=c.node.domElement;r.aspect=e||l.width/l.height,r.updateProjectionMatrix(),s.addEventListenerById(i,j.RenderSizeChang,h=>{const{width:u,height:p}=h;r.aspect=e||u/p,r.updateProjectionMatrix()})}return{instance:r}},lu=K({props:at(be({},un),{fov:{type:Number},aspect:{type:Number},near:{type:Number},far:{type:Number}}),setup(o){const{fov:e,aspect:t,near:n,far:s}=o,{instance:r}=cu(e,t,n,s);return on(o,r),Ye(()=>{}),{instance:r}}});function uu(o,e,t,n,s,r){return null}var hu=Z(lu,[["render",uu],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/perspective-camera/src/perspective-camera.vue"]]);const pu=Y("SDPerspectiveCamera",hu),fu=o=>{const e=V();let t=!0,n=o.domElement;const s=new xt,r=new he,i=[ce.onClick,ce.onPointerMove,ce.onPointerOut,ce.onPointerOver,ce.onPointerDown,ce.onPointerUp,ce.onWheel,ce.onDblClick,ce.onContextmenu];let a=!1;const c={target:null,objects:[],intersects:[],type:ce.None,domEvent:null};let l=-1;const h=y=>{const v=e.getEvenet(ce.onPointerOver,y);if(typeof v=="function"){const S=e.getNode(y);v(S)}},u=y=>{const v=e.getEvenet(ce.onPointerOut,y);if(typeof v=="function"){const S=e.getNode(y);v(S)}},p=()=>{const{target:y,objects:v,intersects:S,type:E}=c;if(S.length>0){const _=S[0].object,{userData:T}=_;if(T.primitive&&T.parentId)l!==T.parentId&&(h(T.parentId),l!==-1&&u(l),l=T.parentId);else{const M=e.getNodeWithObject(_);l!==M.id&&(h(M.id),l!==-1&&u(l),l=M.id)}}else l!=-1&&(u(l),l=-1)},f=()=>{const y=o.getScene();let v;if(y&&(v=e.getNodeWithObject(y)),v&&v.id){const S=e.getChildrens(v.id).map(T=>T.node),E=Fr(S,[Te.isMesh,Te.isGroup,Te.isFBX,Te.isGLTF],!0),_=s.intersectObjects(E,t);c.objects=E,c.intersects=_,p()}},d=y=>{const v=new he;o.getSize(v),r.x=y.offsetX/v.x*2-1,r.y=-(y.offsetY/v.y)*2+1,s.setFromCamera(r,o.getCamera())},m=y=>{if(y instanceof MouseEvent&&y instanceof PointerEvent&&d(y),y.type==ce.onPointerOut){a=!1;return}if(y.type===ce.onPointerOver){a=!0;return}if(y instanceof KeyboardEvent&&a===!1)return;if(c.type=y.type,c.intersects.length>0){const{target:S,objects:E,intersects:_,type:T}=c;let M=_[0].object,R=!1;for(;!R&&M;){let x;const{userData:O}=M;if(O.primitive&&O.parentId?x=e.getNode(O.parentId):x=e.getNodeWithObject(M),x){const C=e.getEvenet(T,x.id);typeof C=="function"&&C(y,c)===!1&&(R=!0),M=x.node.parent}else M=M.parent}}else y instanceof KeyboardEvent&&e.getEventWithType(ce.onKeyMissed).forEach(E=>{typeof E=="function"&&E(y,c)}),y instanceof PointerEvent&&e.getEventWithType(ce.onPointerMissed).forEach(E=>{typeof E=="function"&&E(y,c)}),l=-1;e.getEventWithType("gl"+y.type).forEach(S=>{typeof S=="function"&&S(y,c)})};o.setCallBack(f);const g=[ce.onKeyDown,ce.onKeyup,ce.onKeypress];return g.forEach(y=>{document.addEventListener(y,m)}),i.forEach(y=>{var v;(v=n==null?void 0:n.parentElement)==null||v.addEventListener(y,m)}),{remove:()=>{i.forEach(y=>{var v;(v=n==null?void 0:n.parentElement)==null||v.removeEventListener(y,m)}),g.forEach(y=>{document.removeEventListener(y,m)}),o.delCallBack(f)}}},du={camera:{type:Object,required:!1,default:null},scene:{type:Object,required:!1,default:null},options:{type:Object,required:!1},width:{type:Number,required:!0,default:1e3},height:{type:Number,required:!0,default:1e3},pixelRatio:{type:Number,required:!1,default:window.devicePixelRatio},backgroundColor:{type:Number,required:!1,default:0},backgroundAlpha:{type:Number,required:!1,default:1},renderCallback:{type:Function,required:!1},enableEvent:{type:Boolean,required:!1,default:!0},css2D:{type:Boolean,required:!1,default:!1}},mu=o=>{let e;const t=V(),n=new ac(o);t.addNode(n);const{id:s}=t.getParentAndId();return n.init(s,t),{instance:n,setSize:(a,c)=>{n.setRenderSize(a,c),Ho(()=>{t.dispatchEventById(s,{type:j.RenderSizeChang,width:a,height:c})})},setEvent:a=>{if(a){if(!e){const{remove:c}=fu(n);e=c}}else e&&typeof e=="function"&&(e(),e=null)}}},gu=K({props:du,setup(o){const e=$o(),t=mu(o.options),{instance:n,setSize:s,setEvent:r}=t;s(o.width,o.height),n.setClearColor(o.backgroundColor,o.backgroundAlpha),n.setPixelRatio(o.pixelRatio),o.renderCallback&&n.setCallBack(o.renderCallback),B(()=>o.renderCallback,(l,h)=>{l&&n.setCallBack(l),h&&n.delCallBack(h)}),B(()=>o.scene,l=>{l&&n.setScene(l)}),B(()=>o.camera,l=>{l&&n.setCamera(l)}),B(()=>o.css2D,l=>{n.enableCss2D(l)}),Vs(()=>{s(o.width,o.height)}),Vs(()=>{n.setClearColor(o.backgroundColor,o.backgroundAlpha)}),B(()=>o.pixelRatio,l=>{n.setPixelRatio(l)}),Ye(()=>{var l;o.renderCallback&&n.setCallBack(o.renderCallback),(l=e.value)==null||l.appendChild(n.domElement),o.enableEvent&&r(o.enableEvent),n.renderScene(),o.css2D&&n.enableCss2D(!0)}),J(()=>{o.renderCallback&&n.delCallBack(o.renderCallback),n.dispose()}),B(()=>o.enableEvent,l=>{r(l)});const{width:i,height:a}=Ri(o);return{rendererDom:e,width:i,height:a,a:()=>{console.log("a")}}}});function yu(o,e,t,n,s,r){return Pt(),Rt("div",{ref:"rendererDom",style:Ci({width:o.width+"px",height:o.height+"px",position:"relative"})},[le(o.$slots,"default")],4)}var vu=Z(gu,[["render",yu],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/webgl-renderer/src/WebglRenderer.vue"]]);const wu=Y("SDWebglRenderer",vu),bu=(o,e)=>{const t=V();let n,s=!1;const r=Oe(mt);let i;return!o&&!e&&r&&(i=t.getNode(r),o=i.node.getCamera(),e=i.node.domElement.parentElement),o&&e?(n=new ts(o,e),t.addNode(n)):Ho(()=>{n=new ts(i.node.getCamera(),i.node.domElement.parentElement)}),r&&t.dispatchEventById(r,{type:j.Render,render:()=>{s&&n.update()}}),{instance:n,remove:()=>{n&&n.dispose()},setUpdate:l=>{s=l}}},Eu=K({props:{camera:{type:bs,required:!1},domElement:{type:Object,required:!1},autoRotate:{type:Boolean,required:!1,default:!1},autoRotateSpeed:{type:Boolean,required:!1,default:!1},dampingFactor:{type:Number,required:!1,default:.5},enabled:{type:Boolean,required:!1,default:!0},enableDamping:{type:Boolean,required:!1,default:!1},enablePan:{type:Boolean,required:!1,default:!0},enableRotate:{type:Boolean,required:!1,default:!0},enableZoom:{type:Boolean,required:!1,default:!0},keyPanSpeed:{type:Number,required:!1,default:7},keys:{type:Object,required:!1,default:{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}},maxAzimuthAngle:{type:Number,required:!1,default:1/0},maxDistance:{type:Number,required:!1,default:1/0},maxPolarAngle:{type:Number,required:!1,default:Math.PI},maxZoom:{type:Number,required:!1,default:1/0},minAzimuthAngle:{type:Number,required:!1,default:1/0},minDistance:{type:Number,required:!1,default:0},minPolarAngle:{type:Number,required:!1,default:0},minZoom:{type:Number,required:!1,default:0},mouseButtons:{type:Object,required:!1,default:{LEFT:Ge.ROTATE,MIDDLE:Ge.DOLLY,RIGHT:Ge.PAN}},panSpeed:{type:Number,required:!1,default:1},rotateSpeed:{type:Number,required:!1,default:1},screenSpacePanning:{type:Boolean,required:!1,default:!0},target:{type:A,required:!1,default:void 0},zoomSpeed:{type:Number,required:!1,default:1}},setup(o){let e;Ye(()=>{const{instance:t,setUpdate:n,remove:s}=bu(o.camera,o.domElement);return e=s,B(o,r=>{if(t){const i=["camera","domElement"];let a=["autoRotate","enableDamping"];Object.keys(o).filter(c=>!i.includes(c)).forEach(c=>{a.includes(c)&&(o[c]?n(!0):a=a.filter(l=>l!=c)),t[c]=o[c]}),a.length===0&&n(!1)}}),{instance:t}}),J(()=>{e&&e()})}}),Su={ref:"rendererDom"};function Mu(o,e,t,n,s,r){return Pt(),Rt("div",Su,null,512)}var Tu=Z(Eu,[["render",Mu],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/orbit-controls/src/OrbitControls.vue"]]);const xu=Y("SDOrbitControls",Tu),Yn=new he,_u=(o,e)=>{const t=V();let n,s,r,i;if(!o&&!e&&(n=Oe(mt),n)){t.addEventListenerById(n,j.RenderSizeChang,c=>{const{width:l,height:h}=c;s={width:l,height:h}});const a=t.getNode(n);o=a.node.getCamera(),e=a.node.domElement}if(o&&e){r=new Xo(o,e);const{parentId:a,id:c}=t.addNode(r);if(a){t.getNode(a).node.add(r);const h=new xt,u=d=>{if(s){d.preventDefault(),Yn.x=d.offsetX/s.width*2-1,Yn.y=-(d.offsetY/s.height)*2+1,h.setFromCamera(Yn,o);const g=t.getChildrens(a).filter(y=>jr(y.node)).map(y=>y.node),w=h.intersectObjects(g,!0);if(w.length>0){const y=w[0].object;r.attach(y)}else r.detach()}else console.warn("unknow window size")},p=d=>{if(n){const m=t.getNode(n);if(m.children){const w=m.children.map(y=>t.getNode(y)).find(y=>lc(y.node));w&&(w.node.enabled=!d.value)}}},f=d=>{switch(d.code){case"KeyQ":r.setSpace(r.space==="local"?"world":"local");break;case"KeyW":r.setMode("translate");break;case"KeyE":r.setMode("rotate");break;case"KeyR":r.setMode("scale");break;case"Equal":r.setSize(r.size+.1);break;case"Minus":r.setSize(Math.max(r.size-.1,.1));break;case"Escape":r.reset();break}};e.addEventListener("click",u),r.addEventListener("dragging-changed",p),document.addEventListener("keydown",f,!1),i=()=>{var d;(d=e==null?void 0:e.parentElement)==null||d.removeEventListener("keydown",f),e==null||e.removeEventListener("click",u),r==null||r.removeEventListener("dragging-changed",p),r==null||r.dispose()}}return{instance:r,remove:i}}else console.warn("not found any camera render");return{instance:void 0,remove:i}},Au=K({props:{camera:{type:bs,required:!1},domElement:{type:Object,required:!1}},setup(o){Ye(()=>{const{instance:e,remove:t}=_u(o.camera,o.domElement);return J(()=>{t&&t()}),{instance:e}})}});function Iu(o,e,t,n,s,r){return null}var Lu=Z(Au,[["render",Iu],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/transform-controls/src/TransformControls.vue"]]);const Pu=Y("SDTransformControls",Lu);new he;const Ru=(o,e)=>{const t=V();let n=Oe(mt),s;n?s=t.getNode(n):console.warn("usePointerLockControls no found any webglrender"),s?(o||(o=s.node.getCamera()),e||(e=s.node.domElement)):console.warn("not found webglRender, please check use SDwebglRender");let r,i,a=!1,c=!1,l=!1,h=!1,u=!1,p=Or();const f=new A,d=new A;let m={},g=9.8,w=1,y=10,v=1,S=1,E=1;const _=R=>{m[R]?m[R]():console.warn(` not found callBack with ${R}`)},T=(R,x)=>{m[R]=x},M=R=>{g=R.gravity||g,w=R.mass||w,y=R.moveScale||y,v=R.movingResistance||v,S=R.characterHeight||S,E=R.junpHeight||E};if(o&&e){new xt,r=new Hi(o,e);const{parentId:R,id:x}=t.addNode(r);r.addEventListener("lock",function(){m.lock&&_("lock")}),r.addEventListener("unlock",function(){setTimeout(()=>{m.unlock&&_("unlock")},1e3)});const O=function(I){switch(I.preventDefault(),I.code){case"ArrowUp":case"KeyW":a=!0;break;case"ArrowLeft":case"KeyA":l=!0;break;case"ArrowDown":case"KeyS":c=!0;break;case"ArrowRight":case"KeyD":h=!0;break;case"Space":u===!0&&(f.y+=E),u=!1;break}},C=function(I){switch(I.code){case"ArrowUp":case"KeyW":a=!1;break;case"ArrowLeft":case"KeyA":l=!1;break;case"ArrowDown":case"KeyS":c=!1;break;case"ArrowRight":case"KeyD":h=!1;break}};if(window.addEventListener("keydown",O),window.addEventListener("keyup",C),R){const I=new xt(new A,new A(0,-1,0),0,S),P=(k,N)=>{if(r.isLocked===!0){I.far=S,I.ray.origin.copy(r.getObject().position);const H=t.getChildrens(R).filter(se=>jr(se.node)).map(se=>se.node),oe=I.intersectObjects(H,!1).length>0,X=(N-p)/1e3;f.x-=f.x*v*X,f.z-=f.z*v*X,f.y-=g*w*X,d.z=Number(a)-Number(c),d.x=Number(h)-Number(l),d.normalize(),(a||c)&&(f.z-=d.z*y*X),(l||h)&&(f.x-=d.x*y*X),oe===!0&&(f.y=Math.max(0,f.y),u=!0),r.moveRight(-f.x*X),r.moveForward(-f.z*X),r.getObject().position.y+=f.y*X,r.getObject().position.y<S&&(f.y=0,r.getObject().position.y=S,u=!0)}p=N};s==null||s.node.setCallBack(P)}i=()=>{window.removeEventListener("keydown",O),window.removeEventListener("keyup",C)}}else console.log("not found any camere or domelement");return{instance:r,setCallBack:T,remove:i,setCharacter:M}},Cu=K({props:{camera:{type:bs,required:!1},domElement:{type:Object,required:!1},lock:{type:Boolean,default:!1},connect:{type:Boolean,default:!0},unlockCallback:{type:Function,required:!1},options:{type:Object,required:!1}},setup(o){Ye(()=>{const{instance:e,setCharacter:t,setCallBack:n,remove:s}=Ru(o.camera,o.domElement);o.lock&&e.lock(),o.options&&t(o.options),B(()=>o.lock,r=>{r?e.lock():e.unlock()}),B(()=>o.options,r=>{r&&t(r)}),o.unlockCallback&&n("unlock",o.unlockCallback),J(()=>{s&&s()})})}});function ku(o,e,t,n,s,r){return null}var Du=Z(Cu,[["render",ku],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/pointerlock-controls/src/PointerLockControls.vue"]]);const Nu=Y("SDPointerLockControls",Du),Ou=(o,e,t,n)=>{const s=V();let r=!0,i=!1,a=!0,c=new A,l;const h=new xt(o,new A().copy(e),t,n),{parentId:u,id:p}=s.addNode(h),f=Oe(mt),d=Oe(Gr);let m=!1,g;const w=(x,O)=>{O=be({color:"red",headLength:1,headWidth:1},O);const{color:C,headLength:I,headWidth:P}=O;g=new Pi(x.ray.direction,x.ray.origin,x.far===1/0?2e4:x.far,C,I,P),s.getNode(d).node.add(g)},y=()=>{if(r){const x=new A;let O=new A,C;if(u?(C=s.getNode(u),C&&C.node&&C.node.isObject3D&&C.node.getWorldPosition(x)):x.copy(o),a){const I=new de;C.node.getWorldQuaternion(I);const P=new A;P.copy(e),P.applyQuaternion(I),O.copy(P)}else O.copy(e);if(x.add(c),m&&g&&(g.setDirection(O),g.setLength(h.far===1/0?2e4:h.far),g.position.copy(x)),h.ray.direction.copy(O),h.far=h.far===1/0?2e4:h.far,h.ray.origin.copy(x),d){const I=s.getChildrens(d).map(N=>N.node),P=Fr(I,[Te.isMesh,Te.isGroup,Te.isFBX,Te.isGLTF],!0),k=h.intersectObjects(P,i);if(k.length>0){let N=k[0].object;if(P.includes(k[0].object))l(N,P,k);else{const{userData:F}=N;if(F.primitive&&F.parentId){const H=s.getNode(F.parentId);H&&H.node&&(N=H.node)}l(N,P,k)}}}}};return f&&s.dispatchEventById(f,{type:j.Render,render:y}),{setEnabled:x=>{r=x},updateBack:x=>{l=x},instance:h,remove:()=>{f&&s.dispatchEventById(f,{type:j.RemoveRender,render:y})},setObject:()=>{},setHelper:x=>{x===null?(m=!1,d&&s.getNode(d).node.remove(g)):(m=!0,w(h,x))},setOffset:x=>{c=x},setLockDirection:x=>{a=x}}},Fu=K({props:{origin:{type:A,require:!1,default:new A},offset:{type:A,require:!1,default:new A},direction:{type:A,require:!1,default:new A(0,1,0)},near:{type:Number,require:!1,default:0},far:{type:Number,require:!1,default:1/0},disabled:{type:Boolean,require:!1,default:!1},raycasterCallback:{type:Function,require:!1,default:()=>{}},lockDirection:{type:Boolean,require:!1,default:!0},object:{type:qe,require:!1},checkObjectArray:{type:Array,require:!1},helper:{type:Object,require:!1,default:null}},setup(o){const{origin:e,direction:t,near:n,far:s}=o,{setEnabled:r,setOffset:i,updateBack:a,instance:c,remove:l,setHelper:h,setLockDirection:u}=Ou(e,t,n,s);a(o.raycasterCallback),h(o.helper),i(o.offset),u(o.lockDirection),B(()=>o.origin,p=>{c.ray.origin.copy(p)}),B(()=>o.direction,p=>{c.ray.direction.copy(p)}),B(()=>o.near,p=>{c.near=p}),B(()=>o.far,p=>{c.far=p}),B(()=>o.disabled,p=>{r(p)}),B(()=>o.raycasterCallback,p=>{a(p)}),B(()=>o.helper,p=>{h(p)}),B(()=>o.offset,p=>{i(p)}),B(()=>o.lockDirection,p=>{u(p)}),J(()=>{l()})}});function ju(o,e,t,n,s,r){return null}var Bu=Z(Fu,[["render",ju],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/raycaster/src/Raycaster.vue"]]);const zu=Y("SDRaycaster",Bu),Uu=o=>{const e=V(),t=new Nr(o),{parentId:n,id:s}=e.addNode(t);if(n){const{node:i}=e.getNode(n);i.isObject3D&&i.add(t)}return{remove:()=>{t&&t.parent&&t.parent.remove(t)},id:s,instance:t}},Gu=K({props:be({},un),setup(o){let e;const t=$o();return Ye(()=>{const{instance:n,id:s}=Uu(t.value);e&&e(),e=on(o,n)}),J(()=>{e&&e()}),{css2d:t}}}),Hu={ref:"css2d"};function $u(o,e,t,n,s,r){return Pt(),Rt("div",Hu,[le(o.$slots,"default")],512)}var Xu=Z(Gu,[["render",$u],["__file","/Users/songshuai/Desktop/project_new/sandi-ui/packages/components/css2d-object/src/CSS2DObject.vue"]]);const qu=Y("SDCSS2DObject",Xu);var Vu=[$c,Bc,zu,Dc,jl,dc,wc,yl,Sl,Kl,Jl,Al,el,kl,pu,Hl,wu,xu,Tc,Lc,Pu,Nu,il,pl,qu];class Ku extends ps{constructor(){super(...arguments),this.map=new Map,this.objectsMap=new Map,this.event=new Map}addNode(e){const n=es().uid;e instanceof Uo&&zn(mt,n),e instanceof Go&&e.isScene&&zn(Gr,n),zn(bn,n);const s=Oe(bn);if(s){const r=this.map.get(s);r&&(r.children?r.children.push(n):r.children=[n])}return this.map.set(n,{id:n,parent:s,children:void 0,node:e}),this.objectsMap.set(e,{id:n,parent:s,children:void 0,node:e}),{parentId:s,id:n}}addNodeWithId(e,t,n){if(t){const s=this.map.get(t);s&&(s.children?s.children.push(n):s.children=[n])}return this.map.set(n,{id:n,parent:t,children:void 0,node:e}),{parentId:t,id:n}}setEvenet(e,t,n){this.event.set(`${e}-${t}`,n)}delEvenet(e,t){this.event.delete(`${e}-${t}`)}getEvenet(e,t){return this.event.get(`${e}-${t}`)}getEventWithType(e){let t=[];for(let n of this.event.entries()){const[s,r]=n;s.split("-")[0]===e&&t.push(r)}return t}setNode(e,t){const n=this.map.get(e);if(delete n.node,this.map.has(e)){const s=this.map.get(e);s&&this.objectsMap.delete(s.node),this.objectsMap.set(t,at(be({},n),{node:t}))}this.map.set(e,at(be({},n),{node:t}))}delNode(e){const t=this.map.get(e);if(t!=null&&t.parent){this.objectsMap.delete(t.node);const n=this.map.get(t.parent);if(n!=null&&n.children){const s=n.children.filter(r=>r!=e);s.length>0?n.children=s:n.children=void 0}}this.map.delete(e)}getParentAndId(){const t=es().uid;return{parentId:Oe(bn),id:t}}getNode(e){return this.map.get(e)}getNodeWithObject(e){return this.objectsMap.get(e)}getAllObjects(){return Array.from(this.objectsMap.keys())}getChildrens(e){const t=this.map.get(e);return t?t.children?t.children.map(n=>{const s=this.map.get(n);return s&&s.children?this.getChildrens(s.id).concat(s):[s]}).flat():[t]:[]}getParent(){const e=Oe(bn);if(e)return this.map.get(e)}addEventListenerById(e,t,n){this.addEventListener(`${t}-${e}`,n)}dispatchEventById(e,t){const{type:n}=t;this.dispatchEvent(at(be({},t),{type:`${n}-${e}`}))}}const ah=o=>{const e=new Ku;o.config.globalProperties.$getv3dCore=()=>e,Di(Vu).install(o)};export{j as EventType,Dr as LoopMode,dc as SDAnimationAction,wc as SDAnimationMixer,Tc as SDBoxGeometry,qu as SDCSS2DObject,Dc as SDCapsuleGeometry,Bc as SDConeGeometry,$c as SDCylinderGeometry,el as SDDirectionalLight,ce as SDEvent,Sl as SDFBXLoader,yl as SDGLTFLoader,oh as SDGeometry,jl as SDGroup,ih as SDMaterial,kl as SDMesh,Kl as SDMeshBasicMaterial,Jl as SDMeshLambertMaterial,rh as SDMeshPhongMaterial,xu as SDOrbitControls,pu as SDPerspectiveCamera,Lc as SDPlaneGeometry,pl as SDPointLight,Nu as SDPointerLockControls,zu as SDRaycaster,Hl as SDScene,il as SDSpotLight,Al as SDTextureLoader,Pu as SDTransformControls,wu as SDWebglRenderer,Te as V3dNodeCheck,ah as default,Uu as useCSS2DObject,mu as useRender,Ml as useTexture,du as webglProps};
